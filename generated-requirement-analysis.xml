<?xml version="1.0" encoding="UTF-8"?>
<RequirementAnalysis xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <!-- ========================================================================
       PROJECT INFORMATION
       ======================================================================== -->
  <ProjectInfo>
    <ProjectName>Fiservemea UCS Connector Integration</ProjectName>
    <ProjectType>New Connector Integration</ProjectType>
    <WorkflowFramework>GRACE-UCS Deterministic Workflow Rules</WorkflowFramework>
    <TargetConnector>Fiservemea</TargetConnector>
    <WorkflowRulesPath>grace/rulesbook/codegen/.gracerules</WorkflowRulesPath>
    <TechSpecPath>grace/rulesbook/codegen/references/fiservemea/technical_specification.md</TechSpecPath>
    <CreationDate>2026-02-06</CreationDate>
    <Status>Pending</Status>
  </ProjectInfo>

  <!-- ========================================================================
       WORKFLOW PHASES
       ======================================================================== -->
  <WorkflowPhases>
    <Phase id="phase_1" name="Tech Spec Validation" sequence="1" mandatory="true">
      <Description>Validate technical specification completeness and UCS compatibility</Description>
      <Steps>
        <Step id="p1_s1" sequence="1" mandatory="true">
          <Action>Read tech spec from grace/rulesbook/codegen/references/fiservemea/technical_specification.md</Action>
          <ExpectedOutput>Complete technical specification document loaded</ExpectedOutput>
          <ValidationCriteria>File exists and is readable</ValidationCriteria>
        </Step>
        <Step id="p1_s2" sequence="2" mandatory="true">
          <Action>Validate tech spec completeness and UCS compatibility</Action>
          <ExpectedOutput>Validation report with pass/fail status</ExpectedOutput>
          <ValidationCriteria>
            <Criterion>Connector name specified</Criterion>
            <Criterion>Base URL defined</Criterion>
            <Criterion>API endpoints documented</Criterion>
            <Criterion>Authentication mechanism described</Criterion>
            <Criterion>Supported payment methods listed</Criterion>
            <Criterion>Request/response schemas provided</Criterion>
            <Criterion>Error codes documented</Criterion>
          </ValidationCriteria>
        </Step>
        <Step id="p1_s3" sequence="3" mandatory="true">
          <Action>Extract all connector requirements and supported features</Action>
          <ExpectedOutput>Structured requirements document</ExpectedOutput>
          <ValidationCriteria>All requirements extracted and categorized</ValidationCriteria>
        </Step>
        <Step id="p1_s4" sequence="4" mandatory="true">
          <Action>Log phase completion</Action>
          <Command>timeline.log_phase_end("phase_1_tech_spec_validation", status="success")</Command>
          <ExpectedOutput>Phase 1 marked as completed in timeline</ExpectedOutput>
        </Step>
      </Steps>
      <Dependencies>None</Dependencies>
      <Blocking>true</Blocking>
    </Phase>

    <Phase id="phase_2" name="Foundation Setup" sequence="2" mandatory="true">
      <Description>Establish basic connector structure using UCS conventions</Description>
      <Prerequisites>Phase 1 completed successfully</Prerequisites>
      <Steps>
        <Step id="p2_s1" sequence="1" mandatory="true">
          <SubAgent>Foundation Setup Agent</SubAgent>
          <Action>Environment Validation</Action>
          <Commands>
            <Command>Check UCS repository structure exists</Command>
            <Command>Validate add_connector.sh script exists</Command>
            <Command>Verify backend/ directory structure exists</Command>
          </Commands>
          <ExpectedOutput>Environment validation report</ExpectedOutput>
        </Step>
        <Step id="p2_s2" sequence="2" mandatory="true">
          <SubAgent>Foundation Setup Agent</SubAgent>
          <Action>Tech Spec Analysis</Action>
          <Actions>
            <Action>Read tech spec from grace/rulesbook/codegen/references/fiservemea/technical_specification.md</Action>
            <Action>Extract connector_name and base_url</Action>
            <Action>Validate tech spec completeness</Action>
          </Actions>
          <ExpectedOutput>Connector configuration parameters extracted</ExpectedOutput>
        </Step>
        <Step id="p2_s3" sequence="3" mandatory="true">
          <SubAgent>Foundation Setup Agent</SubAgent>
          <Action>Execute add_connector.sh Script</Action>
          <Command>./add_connector.sh fiservemea {base_url} --force -y</Command>
          <ExpectedOutput>Connector scaffold created successfully</ExpectedOutput>
          <ErrorHandling>Analyze error, fix prerequisites, retry on failure</ErrorHandling>
        </Step>
        <Step id="p2_s4" sequence="4" mandatory="true">
          <SubAgent>Foundation Setup Agent</SubAgent>
          <Action>Cargo Build Validation</Action>
          <Command>cargo build</Command>
          <ExpectedOutput>Successful compilation with no errors</ExpectedOutput>
          <ErrorHandling>Analyze compilation errors, fix using UCS patterns, retry</ErrorHandling>
        </Step>
        <Step id="p2_s5" sequence="5" mandatory="true">
          <SubAgent>Foundation Setup Agent</SubAgent>
          <Action>UCS Convention Validation</Action>
          <Validations>
            <Validation>RouterDataV2 usage (not RouterData)</Validation>
            <Validation>ConnectorIntegrationV2 usage (not ConnectorIntegration)</Validation>
            <Validation>domain_types imports (not hyperswitch_domain_models)</Validation>
            <Validation>Generic struct pattern: Fiservemea&lt;T&gt;</Validation>
          </Validations>
          <ExpectedOutput>All UCS conventions validated</ExpectedOutput>
        </Step>
        <Step id="p2_s6" sequence="6" mandatory="true">
          <SubAgent>Foundation Setup Agent</SubAgent>
          <Action>Completion Confirmation</Action>
          <Outputs>
            <Output>Report: "Foundation Setup COMPLETED"</Output>
            <Output>List of files created/modified</Output>
            <Output>Cargo build successful confirmation</Output>
            <Output>Ready for flow implementation phase</Output>
          </Outputs>
        </Step>
        <Step id="p2_s7" sequence="7" mandatory="true">
          <Action>Log phase completion</Action>
          <Command>timeline.log_phase_end("phase_2_foundation_setup", status="success")</Command>
          <ExpectedOutput>Phase 2 marked as completed in timeline</ExpectedOutput>
        </Step>
      </Steps>
      <Dependencies>Phase 1</Dependencies>
      <Blocking>true</Blocking>
    </Phase>

    <Phase id="phase_2_5" name="Macro Pattern Reference Study" sequence="2.5" mandatory="true">
      <Description>Study macro pattern guides before implementation</Description>
      <Prerequisites>Phase 2 completed successfully</Prerequisites>
      <Steps>
        <Step id="p2_5_s1" sequence="1" mandatory="true">
          <Action>Read macro pattern guides</Action>
          <Documents>
            <Document>guides/patterns/macro_patterns_reference.md</Document>
            <Document>guides/patterns/flow_macro_guide.md</Document>
            <Document>template-generation/macro_templates.md</Document>
          </Documents>
          <ExpectedOutput>All macro pattern documents studied</ExpectedOutput>
        </Step>
        <Step id="p2_5_s2" sequence="2" mandatory="true">
          <Action>Understand key concepts for implementation</Action>
          <Concepts>
            <Concept>How to use create_all_prerequisites! macro</Concept>
            <Concept>How to use macro_connector_implementation! macro</Concept>
            <Concept>Flow-specific macro configurations</Concept>
            <Concept>Request/Response type naming conventions</Concept>
            <Concept>When to use generic &lt;T&gt; types</Concept>
            <Concept>Resource common data selection (PaymentFlowData, RefundFlowData, DisputeFlowData)</Concept>
          </Concepts>
          <ExpectedOutput>Macro pattern understanding confirmed</ExpectedOutput>
        </Step>
        <Step id="p2_5_s3" sequence="3" mandatory="true">
          <Action>Log phase completion</Action>
          <Command>timeline.log_phase_end("phase_2_5_macro_pattern_study", status="success")</Command>
          <ExpectedOutput>Phase 2.5 marked as completed in timeline</ExpectedOutput>
        </Step>
      </Steps>
      <Dependencies>Phase 2</Dependencies>
      <Blocking>true</Blocking>
    </Phase>

    <Phase id="phase_3" name="Flow Implementation" sequence="3" mandatory="true">
      <Description>Implement connector flows in exact sequence</Description>
      <Prerequisites>Phase 2.5 completed successfully</Prerequisites>
      <ExecutionMode>Sequential - each flow must complete before next begins</ExecutionMode>
      <Flows>
        <Flow id="flow_authorize" name="Authorize" sequence="1" mandatory="true">
          <SubAgent>Authorize Flow Implementation Agent</SubAgent>
          <PatternFile>guides/patterns/pattern_authorize.md</PatternFile>
          <Trait>ConnectorIntegrationV2&lt;Authorize, PaymentFlowData, PaymentsAuthorizeData&lt;T&gt;, PaymentsResponseData&gt;</Trait>
          <Steps>
            <Step id="auth_s1" sequence="1" mandatory="true">
              <Action>Read Tech Spec</Action>
              <Source>grace/rulesbook/codegen/references/fiservemea/technical_specification.md</Source>
              <Extractions>
                <Extraction>Flow-specific requirements</Extraction>
                <Extraction>Supported payment methods for Authorize flow</Extraction>
                <Extraction>API endpoints for authorization</Extraction>
                <Extraction>Flow-specific behaviors</Extraction>
              </Extractions>
            </Step>
            <Step id="auth_s2" sequence="2" mandatory="true">
              <Action>Read Flow Pattern</Action>
              <Source>guides/patterns/pattern_authorize.md</Source>
              <Understanding>
                <Item>Implementation patterns and examples</Item>
                <Item>UCS-specific requirements for Authorize flow</Item>
                <Item>Code templates and best practices</Item>
              </Understanding>
            </Step>
            <Step id="auth_s3" sequence="3" mandatory="true">
              <Action>Read Available Utils &amp; Enums</Action>
              <Files>
                <File>backend/grpc-server/src/utils.rs</File>
                <File>backend/domain_types/src/utils.rs</File>
                <File>backend/connector-integration/src/utils.rs</File>
                <File>backend/common_enums/src/enums.rs</File>
              </Files>
              <Objective>Reuse existing utilities and enums as much as possible</Objective>
            </Step>
            <Step id="auth_s4" sequence="4" mandatory="true">
              <Action>Generate Implementation Plan</Action>
              <PlanComponents>
                <Component>Detailed plan for Authorize flow</Component>
                <Component>List of all required methods to implement</Component>
                <Component>Request/response structures needed</Component>
                <Component>Payment method handling approach</Component>
                <Component>Error handling strategy</Component>
              </PlanComponents>
            </Step>
            <Step id="auth_s4_5" sequence="4.5" mandatory="true">
              <Action>Read Macro Pattern Reference</Action>
              <Documents>
                <Document>guides/patterns/macro_patterns_reference.md</Document>
                <Document>guides/patterns/flow_macro_guide.md</Document>
                <Document>template-generation/macro_templates.md</Document>
              </Documents>
              <Understanding>
                <Item>How to use create_all_prerequisites! macro</Item>
                <Item>How to use macro_connector_implementation! macro</Item>
                <Item>Flow-specific macro configurations</Item>
                <Item>Request/Response type naming conventions</Item>
                <Item>When to use generic &lt;T&gt; types</Item>
                <Item>Resource common data selection (PaymentFlowData)</Item>
              </Understanding>
            </Step>
            <Step id="auth_s5" sequence="5" mandatory="true">
              <Action>Execute Implementation Plan - MACRO-BASED APPROACH</Action>
              <SubSteps>
                <SubStep id="auth_s5_a" name="Add Flow to create_all_prerequisites! macro">
                  <File>backend/connector-integration/src/connectors/fiservemea.rs</File>
                  <Actions>
                    <Action>Locate existing create_all_prerequisites! macro invocation</Action>
                    <Action>Add Authorize flow definition to api: [] array</Action>
                  </Actions>
                  <Configuration>
                    <Parameter name="flow">Authorize</Parameter>
                    <Parameter name="request_body">FiservemeaAuthorizeRequest</Parameter>
                    <Parameter name="response_body">FiservemeaAuthorizeResponse</Parameter>
                    <Parameter name="router_data">RouterDataV2&lt;Authorize, PaymentFlowData, PaymentsAuthorizeData&lt;T&gt;, PaymentsResponseData&gt;</Parameter>
                  </Configuration>
                </SubStep>
                <SubStep id="auth_s5_b" name="Implement Flow with macro_connector_implementation!">
                  <Location>AFTER create_all_prerequisites! block in backend/connector-integration/src/connectors/fiservemea.rs</Location>
                  <MacroInvocation>
                    <MacroName>macro_connector_implementation!</MacroName>
                    <Parameters>
                      <Parameter name="connector_default_implementations">[get_content_type, get_error_response_v2]</Parameter>
                      <Parameter name="connector">Fiservemea</Parameter>
                      <Parameter name="curl_request">Json(FiservemeaAuthorizeRequest)</Parameter>
                      <Parameter name="curl_response">FiservemeaAuthorizeResponse</Parameter>
                      <Parameter name="flow_name">Authorize</Parameter>
                      <Parameter name="resource_common_data">PaymentFlowData</Parameter>
                      <Parameter name="flow_request">PaymentsAuthorizeData</Parameter>
                      <Parameter name="flow_response">PaymentsResponseData</Parameter>
                      <Parameter name="http_method">Post</Parameter>
                      <Parameter name="generic_type">T</Parameter>
                      <Parameter name="trait_bounds">PaymentMethodDataTypes + Debug + Sync + Send + 'static + Serialize</Parameter>
                    </Parameters>
                    <OtherFunctions>
                      <Function>
                        <Signature>fn get_headers(&amp;self, req: &amp;RouterDataV2&lt;...&gt;) -&gt; CustomResult&lt;...&gt;</Signature>
                        <Body>self.build_headers(req)</Body>
                      </Function>
                      <Function>
                        <Signature>fn get_url(&amp;self, req: &amp;RouterDataV2&lt;...&gt;) -&gt; CustomResult&lt;String, ...&gt;</Signature>
                        <Body>Ok(format!("{}/{endpoint}", self.connector_base_url_payments(req)))</Body>
                      </Function>
                    </OtherFunctions>
                  </MacroInvocation>
                </SubStep>
                <SubStep id="auth_s5_c" name="Create Request/Response Types in transformers.rs">
                  <File>backend/connector-integration/src/connectors/fiservemea/transformers.rs</File>
                  <Structs>
                    <Struct name="FiservemeaAuthorizeRequest">
                      <Derives>[Debug, Serialize]</Derives>
                      <Generics>&lt;T: PaymentMethodDataTypes + Debug + Sync + Send + 'static + Serialize&gt;</Generics>
                      <Fields>
                        <Field name="amount" type="AmountType" source="amount_converter"/>
                        <Field name="currency" type="String"/>
                        <Field name="payment_method" type="FiservemeaPaymentMethod&lt;T&gt;" condition="if flow needs payment method"/>
                      </Fields>
                      <Constraints>
                        <Constraint>Add ONLY fields from API docs</Constraint>
                        <Constraint>DO NOT add fields "just in case"</Constraint>
                        <Constraint>Remove any field that will always be None</Constraint>
                        <Constraint>Don't use Option unless truly optional per API spec</Constraint>
                      </Constraints>
                    </Struct>
                    <Struct name="FiservemeaAuthorizeResponse">
                      <Derives>[Debug, Deserialize]</Derives>
                      <Fields>
                        <Field name="id" type="String"/>
                        <Field name="status" type="FiservemeaStatus"/>
                      </Fields>
                      <Constraints>
                        <Constraint>Add ONLY fields from API docs that will be used</Constraint>
                        <Constraint>Create enums for status fields instead of String</Constraint>
                      </Constraints>
                    </Struct>
                  </Structs>
                  <Transformers>
                    <Transformer name="RequestTransformer">
                      <Source>FiservemeaRouterData&lt;RouterDataV2&lt;Authorize, ...&gt;, T&gt;</Source>
                      <Target>FiservemeaAuthorizeRequest&lt;T&gt;</Target>
                      <ImplementationRules>
                        <Rule>Extract and transform data from router_data</Rule>
                        <Rule>Use specific NotSupported errors with exact feature names</Rule>
                        <Rule>WRONG: Err(ConnectorError::NotSupported { message: "Not supported" })</Rule>
                        <Rule>CORRECT: Err(ConnectorError::NotSupported { message: "Apple Pay is not supported" })</Rule>
                        <Rule>Only populate fields that exist in the struct</Rule>
                        <Rule>DO NOT set any field to None - remove the field instead</Rule>
                      </ImplementationRules>
                    </Transformer>
                    <Transformer name="ResponseTransformer">
                      <Source>ResponseRouterData&lt;FiservemeaAuthorizeResponse, RouterDataV2&lt;...&gt;&gt;</Source>
                      <Target>RouterDataV2&lt;Authorize, ...&gt;</Target>
                      <ImplementationRules>
                        <Rule>Map response to RouterDataV2</Rule>
                        <Rule>CRITICAL: NEVER hardcode status - ALWAYS derive from response</Rule>
                        <Rule>WRONG: status: AttemptStatus::Charged</Rule>
                        <Rule>CORRECT: status: map_fiservemea_status_to_attempt_status(&amp;item.response.status)</Rule>
                      </ImplementationRules>
                    </Transformer>
                  </Transformers>
                </SubStep>
                <SubStep id="auth_s5_d" name="Add Status Mapping">
                  <FunctionName>map_fiservemea_status_to_attempt_status</FunctionName>
                  <Input>status: &amp;FiservemeaStatus</Input>
                  <Output>common_enums::AttemptStatus</Output>
                  <MappingRules>
                    <Rule>ALWAYS create a dedicated status enum (FiservemeaStatus)</Rule>
                    <Rule>ALWAYS use the status mapping function in response transformers</Rule>
                    <Rule>NEVER hardcode status values like AttemptStatus::Charged directly</Rule>
                    <Rule>Map status based on actual response field, not assumptions</Rule>
                    <Rule>Map ALL possible connector status values from API docs</Rule>
                    <Rule>NEVER leave status variants unmapped</Rule>
                  </MappingRules>
                  <ExampleMappings>
                    <Mapping from="FiservemeaStatus::Success" to="common_enums::AttemptStatus::Charged"/>
                    <Mapping from="FiservemeaStatus::Pending" to="common_enums::AttemptStatus::Pending"/>
                    <Mapping from="FiservemeaStatus::Failed" to="common_enums::AttemptStatus::Failure"/>
                  </ExampleMappings>
                </SubStep>
              </SubSteps>
              <CriticalRules>
                <Rule>NEVER manually implement ConnectorIntegrationV2 - ALWAYS use macros</Rule>
                <Rule>ALWAYS add flow to create_all_prerequisites! before using macro_connector_implementation!</Rule>
                <Rule>Flow name MUST match exactly in both macros</Rule>
                <Rule>Request/Response types MUST match between macro and transformers</Rule>
                <Rule>ALWAYS use domain_types imports (not hyperswitch_*)</Rule>
                <Rule>ALWAYS use RouterDataV2 (not RouterData)</Rule>
                <Rule>Generic &lt;T&gt; needed for Authorize flow using payment method data</Rule>
                <Rule>POST endpoints: always include curl_request parameter</Rule>
              </CriticalRules>
              <CodeQualityRules>
                <Rule>Remove all fields hardcoded to None - if always None, delete the field</Rule>
                <Rule>Don't use Option unless truly optional per API spec</Rule>
                <Rule>NEVER hardcode status - always derive from connector response</Rule>
                <Rule>Use specific NotSupported errors with exact feature names</Rule>
                <Rule>Only validate what's required by connector API</Rule>
                <Rule>Add comments explaining validation logic</Rule>
                <Rule>Only include fields actually used by connector API</Rule>
              </CodeQualityRules>
            </Step>
            <Step id="auth_s6" sequence="6" mandatory="true">
              <Action>Cargo Build and Debug</Action>
              <Command>cargo build</Command>
              <ErrorHandling>
                <Action>Analyze compilation errors</Action>
                <Action>Fix immediately</Action>
                <Action>Ensure all UCS conventions followed</Action>
                <Action>Verify no syntax or type errors</Action>
                <Action>MUST achieve successful build</Action>
              </ErrorHandling>
            </Step>
            <Step id="auth_s7" sequence="7" mandatory="true">
              <Action>Flow Completion Confirmation</Action>
              <Outputs>
                <Output>Report: "Authorize Flow Implementation COMPLETED"</Output>
                <Output>Cargo build successful confirmation</Output>
                <Output>Documentation of what was implemented</Output>
                <Output>Ready for next flow implementation</Output>
              </Outputs>
            </Step>
          </Steps>
        </Flow>

        <!-- Additional flows can be added here following the same pattern -->
        <!-- Examples: PSync, Capture, Void, Refund, RSync, etc. -->
      </Flows>
    </Phase>

    <Phase id="phase_4" name="Final Validation and Quality Review" sequence="4" mandatory="true">
      <Description>Comprehensive validation and quality assurance</Description>
      <Prerequisites>All flows in Phase 3 completed successfully</Prerequisites>
      <Steps>
        <Step id="p4_s1" sequence="1" mandatory="true">
          <Action>Execute final cargo build</Action>
          <Command>cargo build</Command>
          <ExpectedOutput>Successful compilation with zero errors</ExpectedOutput>
        </Step>
        <Step id="p4_s2" sequence="2" mandatory="true">
          <Action>Validate all flows compile successfully</Action>
          <ValidationCriteria>
            <Criterion>No compilation warnings</Criterion>
            <Criterion>All flows implemented</Criterion>
            <Criterion>All tests pass</Criterion>
          </ValidationCriteria>
        </Step>
        <Step id="p4_s3" sequence="3" mandatory="true">
          <SubAgent>Quality Guardian Subagent</SubAgent>
          <Action>Comprehensive code quality review</Action>
          <ReviewAreas>
            <Area>Code style and formatting</Area>
            <Area>UCS convention compliance</Area>
            <Area>Error handling completeness</Area>
            <Area>Status mapping correctness</Area>
            <Area>Documentation completeness</Area>
            <Area>Test coverage</Area>
          </ReviewAreas>
          <ExpectedOutput>Quality review report with approval/rejection</ExpectedOutput>
        </Step>
        <Step id="p4_s4" sequence="4" mandatory="true">
          <Action>Wait for quality review completion and approval</Action>
          <Blocking>true</Blocking>
        </Step>
        <Step id="p4_s5" sequence="5" mandatory="true">
          <Action>Generate completion report</Action>
          <ReportContents>
            <Content>Summary of implemented flows</Content>
            <Content>Files created/modified</Content>
            <Content>Known limitations</Content>
            <Content>Future enhancement opportunities</Content>
          </ReportContents>
        </Step>
        <Step id="p4_s6" sequence="6" mandatory="true">
          <Action>Log phase completion</Action>
          <Command>timeline.log_phase_end("phase_4_quality_review", status="success")</Command>
          <ExpectedOutput>Phase 4 marked as completed in timeline</ExpectedOutput>
        </Step>
        <Step id="p4_s7" sequence="7" mandatory="true">
          <Action>Timeline Finalization</Action>
          <Command>timeline.finalize()</Command>
          <Description>ALWAYS execute this as the final step</Description>
          <ExpectedOutput>Workflow timeline finalized and closed</ExpectedOutput>
        </Step>
      </Steps>
      <Dependencies>Phase 3 (all flows)</Dependencies>
      <Blocking>true</Blocking>
    </Phase>

    <Phase id="phase_5" name="Requirement Resolution Marking" sequence="5" mandatory="true">
      <Description>Mark requirement analysis as resolved upon completion</Description>
      <Prerequisites>Phase 4 completed successfully</Prerequisites>
      <Steps>
        <Step id="p5_s1" sequence="1" mandatory="true">
          <Action>Rename generated-requirement-analysis.xml to generated-requirement-analysis.xml.resolved</Action>
          <Command>mv generated-requirement-analysis.xml generated-requirement-analysis.xml.resolved</Command>
          <ExpectedOutput>File renamed with .resolved extension</ExpectedOutput>
          <Purpose>Indicates all tasks in requirement analysis are completed</Purpose>
        </Step>
      </Steps>
      <Dependencies>Phase 4</Dependencies>
      <Blocking>false</Blocking>
    </Phase>
  </WorkflowPhases>

  <!-- ========================================================================
       TECHNICAL REQUIREMENTS
       ======================================================================== -->
  <TechnicalRequirements>
    <Architecture>
      <Pattern>UCS (Universal Connector Standard)</Pattern>
      <Version>V2</Version>
      <CoreTraits>
        <Trait>RouterDataV2</Trait>
        <Trait>ConnectorIntegrationV2</Trait>
      </CoreTraits>
    </Architecture>

    <ModuleStructure>
      <MainConnectorFile>backend/connector-integration/src/connectors/fiservemea.rs</MainConnectorFile>
      <TransformersFile>backend/connector-integration/src/connectors/fiservemea/transformers.rs</TransformersFile>
      <UtilsFile>backend/connector-integration/src/connectors/fiservemea/utils.rs</UtilsFile>
      <ModFile>backend/connector-integration/src/connectors/fiservemea/mod.rs</ModFile>
    </ModuleStructure>

    <Imports>
      <RequiredImport>domain_types (NOT hyperswitch_domain_models)</RequiredImport>
      <RequiredImport>common_enums</RequiredImport>
      <RequiredImport>error_stack</RequiredImport>
      <RequiredImport>serde::{Serialize, Deserialize}</RequiredImport>
      <RequiredImport>macros (for macro_connector_implementation!)</RequiredImport>
    </Imports>

    <GenericTypes>
      <Usage>Authorize flow requires generic &lt;T&gt; for payment method data</Usage>
      <TraitBounds>PaymentMethodDataTypes + Debug + Sync + Send + 'static + Serialize</TraitBounds>
    </GenericTypes>

    <NamingConventions>
      <RequestType>{ConnectorName}{FlowName}Request</RequestType>
      <ResponseType>{ConnectorName}{FlowName}Response</ResponseType>
      <StatusEnum>{ConnectorName}Status</StatusEnum>
      <StatusMapper>map_{connector_name}_status_to_attempt_status</StatusMapper>
      <PaymentMethod>{ConnectorName}PaymentMethod&lt;T&gt;</PaymentMethod>
    </NamingConventions>

    <Macros>
      <Macro name="create_all_prerequisites!">
        <Purpose>Define API endpoints, types, and converters</Purpose>
        <Location>Top of connector file</Location>
        <Required>true</Required>
      </Macro>
      <Macro name="macro_connector_implementation!">
        <Purpose>Implement ConnectorIntegrationV2 trait</Purpose>
        <Location>After create_all_prerequisites! block</Location>
        <Required>true</Required>
      </Macro>
    </Macros>
  </TechnicalRequirements>

  <!-- ========================================================================
       IMPLEMENTATION PLAN
       ======================================================================== -->
  <ImplementationPlan>
    <PreImplementation>
      <Task id="pre_1">Verify technical specification exists and is complete</Task>
      <Task id="pre_2">Set up development environment</Task>
      <Task id="pre_3">Study UCS macro patterns and guides</Task>
    </PreImplementation>

    <FoundationTasks>
      <Task id="found_1">Run add_connector.sh script with fiservemea parameters</Task>
      <Task id="found_2">Verify generated file structure</Task>
      <Task id="found_3">Validate UCS conventions in generated code</Task>
      <Task id="found_4">Achieve successful cargo build</Task>
    </FoundationTasks>

    <FlowImplementationTasks>
      <Flow name="Authorize">
        <Task id="auth_1">Define FiservemeaAuthorizeRequest struct</Task>
        <Task id="auth_2">Define FiservemeaAuthorizeResponse struct</Task>
        <Task id="auth_3">Define FiservemeaStatus enum</Task>
        <Task id="auth_4">Implement request transformer (TryFrom)</Task>
        <Task id="auth_5">Implement response transformer (TryFrom)</Task>
        <Task id="auth_6">Implement status mapping function</Task>
        <Task id="auth_7">Add Authorize to create_all_prerequisites! macro</Task>
        <Task id="auth_8">Add macro_connector_implementation! for Authorize</Task>
        <Task id="auth_9">Implement get_headers function</Task>
        <Task id="auth_10">Implement get_url function</Task>
        <Task id="auth_11">Cargo build and fix errors</Task>
      </Flow>
    </FlowImplementationTasks>

    <PostImplementation>
      <Task id="post_1">Final cargo build validation</Task>
      <Task id="post_2">Code quality review</Task>
      <Task id="post_3">Generate completion report</Task>
      <Task id="post_4">Mark requirement analysis as resolved</Task>
    </PostImplementation>
  </ImplementationPlan>

  <!-- ========================================================================
       QUALITY ASSURANCE
       ======================================================================== -->
  <QualityAssurance>
    <CodeStandards>
      <Standard id="qs_1">No TODO comments - production ready code only</Standard>
      <Standard id="qs_2">No mock implementations</Standard>
      <Standard id="qs_3">All fields must be used - remove unused fields</Standard>
      <Standard id="qs_4">No hardcoded None values - remove field instead</Standard>
      <Standard id="qs_5">Specific error messages with feature names</Standard>
      <Standard id="qs_6">Status always derived from response, never hardcoded</Standard>
    </CodeStandards>

    <BuildRequirements>
      <Requirement id="br_1">Project must compile without errors</Requirement>
      <Requirement id="br_2">No compilation warnings</Requirement>
      <Requirement id="br_3">Single binary - no multiple binaries causing cargo run confusion</Requirement>
      <Requirement id="br_4">All dependencies resolved</Requirement>
    </BuildRequirements>

    <DatabaseConsistency>
      <Requirement id="db_1">Schema consistent with connector requirements</Requirement>
      <Requirement id="db_2">All required tables/columns present</Requirement>
      <Requirement id="db_3">Migration scripts if needed</Requirement>
    </DatabaseConsistency>

    <TestingRequirements>
      <Requirement id="test_1">Unit tests for transformers</Requirement>
      <Requirement id="test_2">Integration tests for flows</Requirement>
      <Requirement id="test_3">Edge case coverage</Requirement>
      <Requirement id="test_4">Error scenario testing</Requirement>
    </TestingRequirements>

    <DocumentationRequirements>
      <Requirement id="doc_1">Inline comments for complex logic</Requirement>
      <Requirement id="doc_2">API endpoint documentation</Requirement>
      <Requirement id="doc_3">Status mapping documentation</Requirement>
      <Requirement id="doc_4">Error handling documentation</Requirement>
    </DocumentationRequirements>
  </QualityAssurance>

  <!-- ========================================================================
       COMPLETION CRITERIA
       ======================================================================== -->
  <CompletionCriteria>
    <PhaseCompletion>
      <Phase name="Phase 1 - Tech Spec Validation">
        <Criteria>
          <Criterion>Tech spec read successfully</Criterion>
          <Criterion>Completeness validated</Criterion>
          <Criterion>Requirements extracted</Criterion>
          <Criterion>Timeline logged</Criterion>
        </Criteria>
      </Phase>
      <Phase name="Phase 2 - Foundation Setup">
        <Criteria>
          <Criterion>Environment validated</Criterion>
          <Criterion>add_connector.sh executed successfully</Criterion>
          <Criterion>Cargo build successful</Criterion>
          <Criterion>UCS conventions validated</Criterion>
          <Criterion>Timeline logged</Criterion>
        </Criteria>
      </Phase>
      <Phase name="Phase 2.5 - Macro Pattern Study">
        <Criteria>
          <Criterion>All macro guides read</Criterion>
          <Criterion>Key concepts understood</Criterion>
          <Criterion>Timeline logged</Criterion>
        </Criteria>
      </Phase>
      <Phase name="Phase 3 - Flow Implementation">
        <Criteria>
          <Criterion>Authorize flow implemented</Criterion>
          <Criterion>Request/Response types defined</Criterion>
          <Criterion>Transformers implemented</Criterion>
          <Criterion>Status mapping implemented</Criterion>
          <Criterion>Macros configured correctly</Criterion>
          <Criterion>Cargo build successful</Criterion>
        </Criteria>
      </Phase>
      <Phase name="Phase 4 - Final Validation">
        <Criteria>
          <Criterion>Final cargo build successful</Criterion>
          <Criterion>All flows compile</Criterion>
          <Criterion>Quality review passed</Criterion>
          <Criterion>Completion report generated</Criterion>
          <Criterion>Timeline logged</Criterion>
          <Criterion>Timeline finalized</Criterion>
        </Criteria>
      </Phase>
      <Phase name="Phase 5 - Resolution Marking">
        <Criteria>
          <Criterion>XML file renamed to .resolved</Criterion>
        </Criteria>
      </Phase>
    </PhaseCompletion>

    <ProjectCompletion>
      <Criteria>
        <Criterion>All phases completed in sequence</Criterion>
        <Criterion>Zero compilation errors</Criterion>
        <Criterion>Zero compilation warnings</Criterion>
        <Criterion>Quality review approved</Criterion>
        <Criterion>Production-ready code (no TODOs, no mocks)</Criterion>
        <Criterion>Database schema consistent</Criterion>
        <Criterion>Single binary project</Criterion>
        <Criterion>Requirement analysis marked as resolved</Criterion>
      </Criteria>
    </ProjectCompletion>
  </CompletionCriteria>

  <!-- ========================================================================
       ERROR HANDLING STRATEGIES
       ======================================================================== -->
  <ErrorHandling>
    <PhaseErrors>
      <Phase name="Phase 1">
        <Error type="TechSpecNotFound">
          <Action>Verify file path exists</Action>
          <Action>Check file permissions</Action>
          <Action>Request tech spec from user if missing</Action>
        </Error>
        <Error type="IncompleteTechSpec">
          <Action>Identify missing sections</Action>
          <Action>Request clarification from user</Action>
          <Action>Do not proceed until complete</Action>
        </Error>
      </Phase>
      <Phase name="Phase 2">
        <Error type="ScriptExecutionFailed">
          <Action>Analyze error output</Action>
          <Action>Fix prerequisites</Action>
          <Action>Retry script execution</Action>
        </Error>
        <Error type="BuildFailed">
          <Action>Analyze compilation errors</Action>
          <Action>Fix using UCS patterns</Action>
          <Action>Retry build until successful</Action>
        </Error>
        <Error type="ConventionViolation">
          <Action>Identify violated convention</Action>
          <Action>Fix code to match UCS requirements</Action>
          <Action>Re-validate</Action>
        </Error>
      </Phase>
      <Phase name="Phase 3">
        <Error type="CompilationError">
          <Action>Analyze error message</Action>
          <Action>Fix type/syntax issues</Action>
          <Action>Rebuild immediately</Action>
        </Error>
        <Error type="MacroError">
          <Action>Verify macro syntax</Action>
          <Action>Check parameter types</Action>
          <Action>Consult macro reference guides</Action>
        </Error>
        <Error type="TransformerError">
          <Action>Verify TryFrom implementation</Action>
          <Action>Check type conversions</Action>
          <Action>Ensure all fields handled</Action>
        </Error>
      </Phase>
      <Phase name="Phase 4">
        <Error type="BuildFailure">
          <Action>Full code audit</Action>
          <Action>Fix all issues</Action>
          <Action>Rebuild until successful</Action>
        </Error>
        <Error type="QualityReviewFailed">
          <Action>Review quality report</Action>
          <Action>Address all findings</Action>
          <Action>Resubmit for review</Action>
        </Error>
      </Phase>
    </PhaseErrors>

    <GeneralErrorHandling>
      <Principle>Never proceed to next phase with unresolved errors</Principle>
      <Principle>Always analyze root cause before applying fixes</Principle>
      <Principle>Use UCS-specific patterns for error resolution</Principle>
      <Principle>Document all error resolutions for future reference</Principle>
    </GeneralErrorHandling>
  </ErrorHandling>

  <!-- ========================================================================
       SUCCESS METRICS
       ======================================================================== -->
  <SuccessMetrics>
    <Metric id="sm_1" name="Compilation Success Rate" target="100%">
      <Description>All builds must succeed without errors</Description>
    </Metric>
    <Metric id="sm_2" name="Code Quality Score" target="Pass">
      <Description>Must pass quality guardian review</Description>
    </Metric>
    <Metric id="sm_3" name="UCS Convention Compliance" target="100%">
      <Description>All UCS conventions must be followed</Description>
    </Metric>
    <Metric id="sm_4" name="Phase Completion Rate" target="100%">
      <Description>All mandatory phases must complete</Description>
    </Metric>
    <Metric id="sm_5" name="Production Readiness" target="Yes">
      <Description>No TODOs, no mocks, clean code</Description>
    </Metric>
  </SuccessMetrics>

  <!-- ========================================================================
       TRIGGER COMMAND
       ======================================================================== -->
  <TriggerCommand>
    <Command>integrate Fiservemea using grace/rulesbook/codegen/.gracerules</Command>
    <Description>This command initiates the complete deterministic workflow</Description>
  </TriggerCommand>

  <!-- ========================================================================
       NOTES AND ASSUMPTIONS
       ======================================================================== -->
  <NotesAndAssumptions>
    <Note id="note_1">This workflow is for NEW CONNECTOR INTEGRATIONS ONLY</Note>
    <Note id="note_2">Each phase MUST complete successfully before proceeding</Note>
    <Note id="note_3">ALL steps are mandatory and must be executed in exact sequence</Note>
    <Note id="note_4">Macro-based approach is REQUIRED - no manual trait implementations</Note>
    <Note id="note_5">Single binary project - avoid creating multiple binaries</Note>
    <Note id="note_6">Production-ready code only - no TODOs or mock implementations</Note>
    <Note id="note_7">Database schema must be consistent with requirements</Note>
    <Note id="note_8">Final step renames XML to .resolved extension</Note>
    <Assumption id="assump_1">Technical specification exists at specified path</Assumption>
    <Assumption id="assump_2">User has necessary permissions to execute scripts</Assumption>
    <Assumption id="assump_3">Development environment is properly configured</Assumption>
    <Assumption id="assump_4">Rust toolchain and Cargo are installed</Assumption>
  </NotesAndAssumptions>
</RequirementAnalysis>