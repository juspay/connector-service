<?xml version="1.0" encoding="UTF-8"?>
<RequirementAnalysis xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <DocumentMetadata>
    <Title>FiservEMEA Connector - Authorize Flow Implementation</Title>
    <Version>1.0</Version>
    <GeneratedDate>2026-02-13</GeneratedDate>
    <Component>GRACE-UCS Connector Integration</Component>
    <ConnectorName>FiservEMEA</ConnectorName>
  </DocumentMetadata>

  <!-- ========================================================= -->
  <!-- EXECUTIVE SUMMARY                                         -->
  <!-- ========================================================= -->
  <ExecutiveSummary>
    <Objective>
      Implement the Authorize Flow for the FiservEMEA connector using the GRACE-UCS macro-based architecture.
      This implementation follows strict production-grade standards and utilizes the existing macro infrastructure
      to ensure consistency and maintainability across all UCS connectors.
    </Objective>
    <Scope>
      <IncludedFlows>
        <Flow>Authorize</Flow>
      </IncludedFlows>
      <ExcludedFlows>
        <Flow>Capture</Flow>
        <Flow>Refund</Flow>
        <Flow>Void</Flow>
        <Flow>Sync</Flow>
        <Flow>Payment Methods</Flow>
        <Flow>Mandate</Flow>
        <Flow>Dispute</Flow>
        <Flow>Any other payment flow</Flow>
      </ExcludedFlows>
    </Scope>
    <Approach>
      Macro-based implementation using `macro_connector_implementation!` and `create_all_prerequisites!` macros.
      Reference implementation: Airwallex connector.
    </Approach>
  </ExecutiveSummary>

  <!-- ========================================================= -->
  <!-- TECHNICAL SPECIFICATIONS                                  -->
  <!-- ========================================================= -->
  <TechnicalSpecifications>
    <ProgrammingLanguage>Rust 2021</ProgrammingLanguage>
    <Framework>Actix-web 4.9</Framework>
    <Architecture>Macro-based connector implementation</Architecture>
    <TraitImplementation>
      <TraitName>ConnectorIntegrationV2</TraitName>
      <TypeParameters>
        <TypeParameter index="0">Authorize</TypeParameter>
        <TypeParameter index="1">PaymentFlowData</TypeParameter>
        <TypeParameter index="2">PaymentsAuthorizeData&lt;T&gt;</TypeParameter>
        <TypeParameter index="3">PaymentsResponseData</TypeParameter>
      </TypeParameters>
    </TraitImplementation>
  </TechnicalSpecifications>

  <!-- ========================================================= -->
  <!-- FILES TO BE MODIFIED                                      -->
  <!-- ========================================================= -->
  <FileModifications>
    <StrictRule>
      <Description>ONLY the following two files may be modified. Any modification to other files is strictly prohibited.</Description>
    </StrictRule>
    <Files>
      <File>
        <Path>backend/connector-integration/src/connectors/fiservemea.rs</Path>
        <Purpose>Main connector implementation file containing macro invocations</Purpose>
        <ChangesRequired>
          <Change>Add Authorize flow to create_all_prerequisites! macro</Change>
          <Change>Implement Authorize flow using macro_connector_implementation! macro</Change>
        </ChangesRequired>
      </File>
      <File>
        <Path>backend/connector-integration/src/connectors/fiservemea/transformers.rs</Path>
        <Purpose>Transformer definitions for request/response types</Purpose>
        <ChangesRequired>
          <Change>Define FiservemeaAuthorizeRequest&lt;T&gt; struct</Change>
          <Change>Define FiservemeaAuthorizeResponse struct</Change>
          <Change>Define FiservemeaStatus enum</Change>
          <Change>Define FiservemeaPaymentMethod&lt;T&gt; enum/struct</Change>
          <Change>Implement map_fiservemea_status_to_attempt_status function</Change>
          <Change>Implement auth_request_transformer function</Change>
          <Change>Implement auth_response_transformer function</Change>
        </ChangesRequired>
      </File>
    </Files>
  </FileModifications>

  <!-- ========================================================= -->
  <!-- REFERENCE DOCUMENTATION                                   -->
  <!-- ========================================================= -->
  <ReferenceDocumentation>
    <MandatoryReadings>
      <Document>
        <Path>fiservemea/technicalspecification.md</Path>
        <Purpose>Contains FiservEMEA API specifications, endpoints, request/response formats</Purpose>
        <Priority>Highest</Priority>
      </Document>
      <Document>
        <Path>guides/patterns/pattern_authorize.md</Path>
        <Purpose>Defines the standard pattern for Authorize flow implementation</Purpose>
        <Priority>Highest</Priority>
      </Document>
      <Document>
        <Path>guides/patterns/macro_patterns_reference.md</Path>
        <Purpose>Explains macro usage patterns and conventions</Purpose>
        <Priority>High</Priority>
      </Document>
      <Document>
        <Path>guides/patterns/flow_macro_guide.md</Path>
        <Purpose>Guide for flow-specific macro configurations</Purpose>
        <Priority>High</Priority>
      </Document>
      <Document>
        <Path>template-generation/macro_templates.md</Path>
        <Purpose>Template definitions for macro-based implementations</Purpose>
        <Priority>High</Priority>
      </Document>
    </MandatoryReadings>
    <ReferenceImplementation>
      <Connector>Airwallex</Connector>
      <Files>
        <File>backend/connector-integration/src/connectors/airwallex.rs</File>
        <File>backend/connector-integration/src/connectors/airwallex/transformers.rs</File>
      </Files>
      <Purpose>Reference for correct macro usage and transformer patterns</Purpose>
    </ReferenceImplementation>
    <UtilityModules>
      <Module>
        <Path>backend/grpc-server/src/utils.rs</Path>
        <Purpose>Utility functions for gRPC server</Purpose>
      </Module>
      <Module>
        <Path>backend/domain_types/src/utils.rs</Path>
        <Purpose>Domain type utilities and helpers</Purpose>
      </Module>
      <Module>
        <Path>backend/connector-integration/src/utils.rs</Path>
        <Purpose>Connector integration utilities</Purpose>
      </Module>
      <Module>
        <Path>backend/common_enums/src/enums.rs</Path>
        <Purpose>Common enumerations including AttemptStatus</Purpose>
      </Module>
    </UtilityModules>
  </ReferenceDocumentation>

  <!-- ========================================================= -->
  <!-- IMPLEMENTATION WORKFLOW                                   -->
  <!-- ========================================================= -->
  <ImplementationWorkflow>
    <Phase id="1" name="TECH_SPEC_VALIDATION">
      <Description>Read and validate the FiservEMEA technical specification</Description>
      <Steps>
        <Step sequence="1">
          <Action>Read fiservemea/technicalspecification.md</Action>
          <ExpectedOutput>Complete understanding of FiservEMEA API endpoints, authentication, request/response formats</ExpectedOutput>
        </Step>
        <Step sequence="2">
          <Action>Validate tech spec completeness</Action>
          <ValidationCriteria>
            <Criterion>Authorize endpoint URL documented</Criterion>
            <Criterion>Request body schema defined</Criterion>
            <Criterion>Response body schema defined</Criterion>
            <Criterion>Status codes and their meanings listed</Criterion>
            <Criterion>Authentication method specified</Criterion>
            <Criterion>Supported payment methods documented</Criterion>
          </ValidationCriteria>
        </Step>
        <Step sequence="3">
          <Action>Extract connector requirements</Action>
          <Deliverable>List of all supported features and constraints for FiservEMEA</Deliverable>
        </Step>
      </Steps>
    </Phase>

    <Phase id="2" name="MACRO_PATTERN_REFERENCE_STUDY">
      <Description>Study macro patterns and reference implementations</Description>
      <Steps>
        <Step sequence="1">
          <Action>Read guides/patterns/macro_patterns_reference.md</Action>
          <LearningObjectives>
            <Objective>Understanding of create_all_prerequisites! macro usage</Objective>
            <Objective>Understanding of macro_connector_implementation! macro usage</Objective>
            <Objective>Flow-specific macro configuration patterns</Objective>
          </LearningObjectives>
        </Step>
        <Step sequence="2">
          <Action>Read guides/patterns/flow_macro_guide.md</Action>
          <LearningObjectives>
            <Objective>Request/Response type naming conventions</Objective>
            <Objective>When to use generic &lt;T&gt; types</Objective>
            <Objective>Resource common data selection criteria</Objective>
          </LearningObjectives>
        </Step>
        <Step sequence="3">
          <Action>Read template-generation/macro_templates.md</Action>
          <LearningObjectives>
            <Objective>Available macro templates</Objective>
            <Objective>Template parameter requirements</Objective>
          </LearningObjectives>
        </Step>
        <Step sequence="4">
          <Action>Study Airwallex reference implementation</Action>
          <FilesToReview>
            <File>airwallex.rs - Focus on Authorize flow macro invocation</File>
            <File>airwallex/transformers.rs - Focus on Authorize request/response transformers</File>
          </FilesToReview>
        </Step>
      </Steps>
    </Phase>

    <Phase id="3" name="AUTHORIZE_FLOW_IMPLEMENTATION">
      <Description>Implement the Authorize flow for FiservEMEA connector</Description>
      <Steps>
        <Step sequence="1">
          <Action>Read flow pattern documentation</Action>
          <Document>guides/patterns/pattern_authorize.md</Document>
        </Step>
        <Step sequence="2">
          <Action>Review utility modules and enums</Action>
          <Modules>
            <Module>backend/grpc-server/src/utils.rs</Module>
            <Module>backend/domain_types/src/utils.rs</Module>
            <Module>backend/connector-integration/src/utils.rs</Module>
            <Module>backend/common_enums/src/enums.rs</Module>
          </Modules>
        </Step>
        <Step sequence="3">
          <Action>Generate implementation plan</Action>
          <Deliverable>Detailed plan for Authorize flow implementation</Deliverable>
        </Step>
        <Step sequence="4">
          <Action>Study Airwallex macro implementation</Action>
          <FocusAreas>
            <Area>How Authorize flow is added to create_all_prerequisites!</Area>
            <Area>How macro_connector_implementation! is configured for Authorize</Area>
            <Area>Request/Response type definitions in transformers</Area>
            <Area>Status mapping implementation</Area>
          </FocusAreas>
        </Step>
        <Step sequence="5">
          <Action>Add Authorize flow to create_all_prerequisites! macro</Action>
          <File>fiservemea.rs</File>
          <Prerequisite>Must be done BEFORE macro_connector_implementation!</Prerequisite>
        </Step>
        <Step sequence="6">
          <Action>Implement Authorize flow with macro_connector_implementation!</Action>
          <File>fiservemea.rs</File>
          <Configuration>
            <Connector>Fiservemea</Connector>
            <Flow>Authorize</Flow>
            <ResourceCommonData>PaymentFlowData</ResourceCommonData>
            <FlowRequest>PaymentsAuthorizeData&lt;T&gt;</FlowRequest>
            <FlowResponse>PaymentsResponseData</FlowResponse>
            <HttpMethod>Post</HttpMethod>
            <GenericType>T</GenericType>
          </Configuration>
        </Step>
        <Step sequence="7">
          <Action>Create Request/Response types in transformers.rs</Action>
          <File>fiservemea/transformers.rs</File>
          <Types>
            <Type>FiservemeaAuthorizeRequest&lt;T&gt;</Type>
            <Type>FiservemeaAuthorizeResponse</Type>
            <Type>FiservemeaStatus</Type>
            <Type>FiservemeaPaymentMethod&lt;T&gt;</Type>
          </Types>
        </Step>
        <Step sequence="8">
          <Action>Add status mapping function</Action>
          <FunctionName>map_fiservemea_status_to_attempt_status</FunctionName>
          <Input>&amp;FiservemeaStatus</Input>
          <Output>common_enums::AttemptStatus</Output>
        </Step>
      </Steps>
    </Phase>

    <Phase id="4" name="FINAL_VALIDATION">
      <Description>Validate the complete implementation</Description>
      <Steps>
        <Step sequence="1">
          <Action>Confirm Authorize flow implementation completion</Action>
          <ValidationChecklist>
            <Check>create_all_prerequisites! macro includes Authorize flow</Check>
            <Check>macro_connector_implementation! invoked for Authorize flow</Check>
            <Check>All required types defined in transformers.rs</Check>
            <Check>Status mapping function implemented</Check>
            <Check>No other flows implemented</Check>
            <Check>No core files modified</Check>
          </ValidationChecklist>
        </Step>
      </Steps>
    </Phase>
  </ImplementationWorkflow>

  <!-- ========================================================= -->
  <!-- MACRO CONFIGURATION REQUIREMENTS                          -->
  <!-- ========================================================= -->
  <MacroConfigurationRequirements>
    <create_all_prerequisitesMacro>
      <Purpose>Declare flow prerequisites before implementation</Purpose>
      <Location>fiservemea.rs</Location>
      <ExecutionOrder>FIRST - Must be called before macro_connector_implementation!</ExecutionOrder>
      <AuthorizeEntry>
        <Flow>Authorize</Flow>
        <RequestBody>FiservemeaAuthorizeRequest</RequestBody>
        <ResponseBody>FiservemeaAuthorizeResponse</ResponseBody>
        <RouterData>RouterDataV2&lt;Authorize, PaymentFlowData, PaymentsAuthorizeData&lt;T&gt;, PaymentsResponseData&gt;</RouterData>
      </AuthorizeEntry>
    </create_all_prerequisitesMacro>

    <macro_connector_implementation>
      <Purpose>Implement the Authorize flow using macro-based approach</Purpose>
      <Location>fiservemea.rs</Location>
      <ExecutionOrder>AFTER create_all_prerequisites!</ExecutionOrder>
      <Configuration>
        <ConnectorDefaultImplementations>
          <Implementation>get_content_type</Implementation>
          <Implementation>get_error_response_v2</Implementation>
        </ConnectorDefaultImplementations>
        <Connector>Fiservemea</Connector>
        <CurlRequest>Json(FiservemeaAuthorizeRequest)</CurlRequest>
        <CurlResponse>FiservemeaAuthorizeResponse</CurlResponse>
        <FlowName>Authorize</FlowName>
        <ResourceCommonData>PaymentFlowData</ResourceCommonData>
        <FlowRequest>PaymentsAuthorizeData&lt;T&gt;</FlowRequest>
        <FlowResponse>PaymentsResponseData</FlowResponse>
        <HttpMethod>Post</HttpMethod>
        <GenericType>T</GenericType>
        <Traits>PaymentMethodDataTypes + Debug + Sync + Send + 'static + Serialize</Traits>
      </Configuration>
    </macro_connector_implementation>
  </MacroConfigurationRequirements>

  <!-- ========================================================= -->
  <!-- TRANSFORMER SPECIFICATIONS                                -->
  <!-- ========================================================= -->
  <TransformerSpecifications>
    <RequestTransformer>
      <StructName>FiservemeaAuthorizeRequest&lt;T&gt;</StructName>
      <GenericBounds>
        <Bound>T: PaymentMethodDataTypes + Debug + Sync + Send + 'static + Serialize</Bound>
      </GenericBounds>
      <DeriveAttributes>
        <Attribute>Debug</Attribute>
        <Attribute>Serialize</Attribute>
      </DeriveAttributes>
      <SerdeAttributes>
        <Attribute>#[serde(rename_all = "camelCase")]</Attribute>
      </SerdeAttributes>
      <Fields>
        <Field name="amount" type="AmountType" required="true">
          <Description>Transaction amount in minor currency units</Description>
        </Field>
        <Field name="currency" type="String" required="true">
          <Description>Three-letter ISO 4217 currency code</Description>
        </Field>
        <Field name="payment_method" type="FiservemeaPaymentMethod&lt;T&gt;" required="true">
          <Description>Payment method details</Description>
        </Field>
        <!-- Additional fields to be determined from FiservEMEA API specification -->
      </Fields>
      <FieldRules>
        <Rule>Add ONLY fields documented in FiservEMEA API specification</Rule>
        <Rule>Remove any field that will always be None</Rule>
        <Rule>Don't use Option&lt;T&gt; unless truly optional per API spec</Rule>
        <Rule>Use snake_case for Rust field names</Rule>
        <Rule>Use camelCase for JSON serialization via serde attribute</Rule>
      </FieldRules>
    </RequestTransformer>

    <ResponseTransformer>
      <StructName>FiservemeaAuthorizeResponse</StructName>
      <DeriveAttributes>
        <Attribute>Debug</Attribute>
        <Attribute>Deserialize</Attribute>
      </DeriveAttributes>
      <SerdeAttributes>
        <Attribute>#[serde(rename_all = "camelCase")]</Attribute>
      </SerdeAttributes>
      <Fields>
        <Field name="id" type="String" required="true">
          <Description>Unique transaction identifier from FiservEMEA</Description>
        </Field>
        <Field name="status" type="FiservemeaStatus" required="true">
          <Description>Transaction status from FiservEMEA</Description>
        </Field>
        <!-- Additional fields to be determined from FiservEMEA API specification -->
      </Fields>
      <FieldRules>
        <Rule>Add ONLY fields that will be used in response processing</Rule>
        <Rule>Create enums for status fields instead of String</Rule>
        <Rule>Use snake_case for Rust field names</Rule>
        <Rule>Use camelCase for JSON deserialization via serde attribute</Rule>
      </FieldRules>
    </ResponseTransformer>

    <PaymentMethodType>
      <Name>FiservemeaPaymentMethod&lt;T&gt;</Name>
      <Description>Enum representing supported payment methods for FiservEMEA</Description>
      <Variants>
        <!-- Variants to be determined from FiservEMEA API specification -->
        <!-- Examples based on typical payment methods: -->
        <!-- <Variant name="Card" type="CardDetails" /> -->
        <!-- <Variant name="BankTransfer" type="BankTransferDetails" /> -->
      </Variants>
    </PaymentMethodType>

    <StatusEnum>
      <Name>FiservemeaStatus</Name>
      <Description>Enum representing all possible status values from FiservEMEA API</Description>
      <DeriveAttributes>
        <Attribute>Debug</Attribute>
        <Attribute>Clone</Attribute>
        <Attribute>Copy</Attribute>
        <Attribute>Eq</Attribute>
        <Attribute>PartialEq</Attribute>
        <Attribute>Serialize</Attribute>
        <Attribute>Deserialize</Attribute>
      </DeriveAttributes>
      <SerdeAttributes>
        <Attribute>#[serde(rename_all = "SCREAMING_SNAKE_CASE")]</Attribute>
      </SerdeAttributes>
      <Variants>
        <!-- Variants to be determined from FiservEMEA API specification -->
        <!-- Examples: -->
        <!-- <Variant name="Approved" /> -->
        <!-- <Variant name="Declined" /> -->
        <!-- <Variant name="Pending" /> -->
        <!-- <Variant name="Failed" /> -->
      </Variants>
      <Rules>
        <Rule>Include ALL possible status values from FiservEMEA API documentation</Rule>
        <Rule>Do not omit any status value even if not currently mapped</Rule>
        <Rule>Use SCREAMING_SNAKE_CASE for serde representation</Rule>
      </Rules>
    </StatusEnum>
  </TransformerSpecifications>

  <!-- ========================================================= -->
  <!-- STATUS MAPPING REQUIREMENTS                               -->
  <!-- ========================================================= -->
  <StatusMappingRequirements>
    <FunctionName>map_fiservemea_status_to_attempt_status</FunctionName>
    <Signature>
      <Input>&amp;FiservemeaStatus</Input>
      <Output>common_enums::AttemptStatus</Output>
    </Signature>
    <Purpose>Map FiservEMEA-specific status values to unified AttemptStatus enum</Purpose>
    <MappingRules>
      <Rule>ALWAYS create dedicated status enum (FiservemeaStatus)</Rule>
      <Rule>ALWAYS use mapping function in response transformers</Rule>
      <Rule>NEVER hardcode status values</Rule>
      <Rule>Map ALL possible connector status values from API docs</Rule>
      <Rule>Handle unknown/unmapped statuses appropriately</Rule>
    </MappingRules>
    <TargetStatusValues>
      <!-- These are the common_enums::AttemptStatus values to map to -->
      <Status>Charged</Status>
      <Status>AuthorizationInitiated</Status>
      <Status>ChargeInitiated</Status>
      <Status>Pending</Status>
      <Status>Failure</Status>
      <Status>AuthenticationFailed</Status>
      <Status>AuthenticationPending</Status>
      <Status>AuthenticationSuccessful</Status>
      <Status>VoidInitiated</Status>
      <Status>Voided</Status>
      <Status>AutoRefunded</Status>
      <Status>RefundInitiated</Status>
      <Status>Refunded</Status>
      <Status>RefundFailed</Status>
      <Status>ConfirmationPending</Status>
      <Status>Confirmed</Status>
      <Status>Cancelled</Status>
      <Status>CodInitiated</Status>
      <Status>CodPending</Status>
      <Status>Unresolved</Status>
      <Status>RouterPending</Status>
    </TargetStatusValues>
  </StatusMappingRequirements>

  <!-- ========================================================= -->
  <!-- SERDE CONFIGURATION RULES                                 -->
  <!-- ========================================================= -->
  <SerdeConfigurationRules>
    <RustFieldNaming>
      <Convention>snake_case</Convention>
      <Example>transaction_id, payment_method, card_holder_name</Example>
    </RustFieldNaming>
    <JsonNaming>
      <Convention>camelCase</Convention>
      <Attribute>#[serde(rename_all = "camelCase")]</Attribute>
      <Example>transactionId, paymentMethod, cardHolderName</Example>
    </JsonNaming>
    <SpecialCases>
      <Case>
        <Scenario>Status enums</Scenario>
        <Convention>SCREAMING_SNAKE_CASE</Convention>
        <Attribute>#[serde(rename_all = "SCREAMING_SNAKE_CASE")]</Attribute>
        <Example>APPROVED, DECLINED, PENDING_AUTHORIZATION</Example>
      </Case>
    </SpecialCases>
  </SerdeConfigurationRules>

  <!-- ========================================================= -->
  <!-- CODE QUALITY REQUIREMENTS                                 -->
  <!-- ========================================================= -->
  <CodeQualityRequirements>
    <CriticalRules>
      <Rule priority="highest">
        <Description>NEVER manually implement ConnectorIntegrationV2 trait</Description>
        <Enforcement>ALWAYS use macro_connector_implementation! macro</Enforcement>
      </Rule>
      <Rule priority="highest">
        <Description>ALWAYS add flow to create_all_prerequisites! before using macro_connector_implementation!</Description>
        <Reason>Prerequisites must be declared before implementation</Reason>
      </Rule>
      <Rule priority="high">
        <Description>Flow name MUST match exactly in both macros</Description>
        <Example>"Authorize" in both create_all_prerequisites! and macro_connector_implementation!</Example>
      </Rule>
      <Rule priority="high">
        <Description>Request/Response types MUST match between macro and transformers</Description>
        <Example>FiservemeaAuthorizeRequest in both macro invocation and struct definition</Example>
      </Rule>
      <Rule priority="high">
        <Description>ALWAYS use domain_types imports (not hyperswitch_*)</Description>
        <Reason>Domain types are the canonical source</Reason>
      </Rule>
      <Rule priority="high">
        <Description>ALWAYS use RouterDataV2 (not RouterData)</Description>
        <Reason>V2 is the current version</Reason>
      </Rule>
      <Rule priority="medium">
        <Description>Generic &lt;T&gt; needed for Authorize flow</Description>
        <Reason>To support multiple payment method types</Reason>
      </Rule>
      <Rule priority="medium">
        <Description>GET endpoints: omit curl_request parameter in macro</Description>
        <Note>Not applicable for Authorize flow which uses POST</Note>
      </Rule>
      <Rule priority="medium">
        <Description>POST/PUT endpoints: always include curl_request parameter</Description>
        <Application>Authorize flow uses POST, so curl_request is required</Application>
      </Rule>
      <Rule priority="medium">
        <Description>Remove all fields hardcoded to None</Description>
        <Reason>If always None, the field serves no purpose</Reason>
      </Rule>
      <Rule priority="medium">
        <Description>Don't use Option&lt;T&gt; unless truly optional per API spec</Description>
        <Reason>Overuse of Option reduces code clarity</Reason>
      </Rule>
      <Rule priority="high">
        <Description>NEVER hardcode status - always derive from connector response</Description>
        <Reason>Status must reflect actual connector state</Reason>
      </Rule>
      <Rule priority="medium">
        <Description>Use specific NotSupported errors with exact feature names</Description>
        <Example>NotSupported("PaymentMethod::ApplePay")</Example>
      </Rule>
      <Rule priority="medium">
        <Description>Only include fields actually used by the connector API</Description>
        <Reason>Avoid unnecessary payload bloat</Reason>
      </Rule>
    </CriticalRules>

    <ProhibitedPatterns>
      <Pattern>
        <Name>Manual Trait Implementation</Name>
        <Description>Manually implementing ConnectorIntegrationV2 trait</Description>
        <CorrectApproach>Use macro_connector_implementation! macro</CorrectApproach>
      </Pattern>
      <Pattern>
        <Name>Panic Operations</Name>
        <Description>Using unwrap() or expect()</Description>
        <CorrectApproach>Use proper error handling with ? operator or match</CorrectApproach>
      </Pattern>
      <Pattern>
        <Name>False Success</Name>
        <Description>Returning success on error conditions</Description>
        <CorrectApproach>Propagate errors correctly</CorrectApproach>
      </Pattern>
      <Pattern>
        <Name>Just-in-case Fields</Name>
        <Description>Adding fields "just in case" they might be needed</Description>
        <CorrectApproach>Only add fields required by API spec</CorrectApproach>
      </Pattern>
      <Pattern>
        <Name>Mocked Responses</Name>
        <Description>Returning mocked or hardcoded responses</Description>
        <CorrectApproach>Always process actual connector responses</CorrectApproach>
      </Pattern>
    </ProhibitedPatterns>
  </CodeQualityRequirements>

  <!-- ========================================================= -->
  <!-- IMPORT REQUIREMENTS                                       -->
  <!-- ========================================================= -->
  <ImportRequirements>
    <GeneralRules>
      <Rule>ALWAYS use domain_types imports (not hyperswitch_*)</Rule>
      <Rule>Use fully qualified paths when necessary to avoid conflicts</Rule>
    </GeneralRules>
    <LikelyRequiredImports>
      <ImportCategory name="Domain Types">
        <Import>domain_types::router_data_v2::{RouterDataV2, PaymentFlowData}</Import>
        <Import>domain_types::payments::{PaymentsAuthorizeData, PaymentsResponseData}</Import>
        <Import>domain_types::types::{PaymentMethodData, AmountType}</Import>
      </ImportCategory>
      <ImportCategory name="Common Enums">
        <Import>common_enums::AttemptStatus</Import>
        <Import>common_enums::Currency</Import>
        <Import>common_enums::PaymentMethod</Import>
      </ImportCategory>
      <ImportCategory name="Connector Interface">
        <Import>connector_interface::errors::ConnectorError</Import>
        <Import>connector_interface::flows::Authorize</Import>
      </ImportCategory>
      <ImportCategory name="Serde">
        <Import>serde::{Serialize, Deserialize}</Import>
      </ImportCategory>
      <ImportCategory name="Standard Library">
        <Import>std::fmt::Debug</Import>
      </ImportCategory>
    </LikelyRequiredImports>
  </ImportRequirements>

  <!-- ========================================================= -->
  <!-- DELIVERABLES                                              -->
  <!-- ========================================================= -->
  <Deliverables>
    <Deliverable id="D1">
      <Name>Updated fiservemea.rs</Name>
      <Path>backend/connector-integration/src/connectors/fiservemea.rs</Path>
      <Contents>
        <ContentItem>Authorize flow entry in create_all_prerequisites! macro</ContentItem>
        <ContentItem>macro_connector_implementation! invocation for Authorize flow</ContentItem>
        <ContentItem>Required imports for domain types and enums</ContentItem>
      </Contents>
      <ValidationCriteria>
        <Criterion>create_all_prerequisites! contains Authorize entry</Criterion>
        <Criterion>macro_connector_implementation! properly configured for Authorize</Criterion>
        <Criterion>No manual ConnectorIntegrationV2 implementation</Criterion>
        <Criterion>No other flows implemented</Criterion>
      </ValidationCriteria>
    </Deliverable>

    <Deliverable id="D2">
      <Name>Updated fiservemea/transformers.rs</Name>
      <Path>backend/connector-integration/src/connectors/fiservemea/transformers.rs</Path>
      <Contents>
        <ContentItem>FiservemeaAuthorizeRequest&lt;T&gt; struct definition</ContentItem>
        <ContentItem>FiservemeaAuthorizeResponse struct definition</ContentItem>
        <ContentItem>FiservemeaStatus enum definition</ContentItem>
        <ContentItem>FiservemeaPaymentMethod&lt;T&gt; enum/struct definition</ContentItem>
        <ContentItem>map_fiservemea_status_to_attempt_status function</ContentItem>
        <ContentItem>auth_request_transformer function</ContentItem>
        <ContentItem>auth_response_transformer function</ContentItem>
      </Contents>
      <ValidationCriteria>
        <Criterion>All structs have appropriate derive attributes</Criterion>
        <Criterion>Serde rename_all attributes correctly applied</Criterion>
        <Criterion>Status enum covers all API values</Criterion>
        <Criterion>Status mapping function handles all cases</Criterion>
        <Criterion>No unused fields present</Criterion>
        <Criterion>No fields hardcoded to None</Criterion>
      </ValidationCriteria>
    </Deliverable>
  </Deliverables>

  <!-- ========================================================= -->
  <!-- VALIDATION CHECKLIST                                      -->
  <!-- ========================================================= -->
  <ValidationChecklist>
    <Category name="Scope Compliance">
      <Check id="VC1" required="true">
        <Description>ONLY Authorize flow implemented</Description>
        <Verification>Search for any other flow implementations (Capture, Refund, Void, etc.)</Verification>
      </Check>
      <Check id="VC2" required="true">
        <Description>No core files modified</Description>
        <Verification>Confirm only fiservemea.rs and fiservemea/transformers.rs were changed</Verification>
      </Check>
    </Category>

    <Category name="Macro Usage">
      <Check id="VC3" required="true">
        <Description>create_all_prerequisites! macro updated with Authorize flow</Description>
        <Verification>Verify Authorize entry exists in create_all_prerequisites! macro</Verification>
      </Check>
      <Check id="VC4" required="true">
        <Description>macro_connector_implementation! used for Authorize flow</Description>
        <Verification>Verify macro_connector_implementation! invoked with Authorize parameters</Verification>
      </Check>
      <Check id="VC5" required="true">
        <Description>No manual ConnectorIntegrationV2 implementation</Description>
        <Verification>Search for "impl ConnectorIntegrationV2" - should not exist</Verification>
      </Check>
      <Check id="VC6" required="true">
        <Description>Flow names match between macros</Description>
        <Verification>Compare flow name in create_all_prerequisites! and macro_connector_implementation!</Verification>
      </Check>
    </Category>

    <Category name="Type Definitions">
      <Check id="VC7" required="true">
        <Description>Request/Response types defined in transformers.rs</Description>
        <Verification>Verify FiservemeaAuthorizeRequest and FiservemeaAuthorizeResponse exist</Verification>
      </Check>
      <Check id="VC8" required="true">
        <Description>Type names match between macro and transformers</Description>
        <Verification>Compare type names in macro invocation and struct definitions</Verification>
      </Check>
      <Check id="VC9" required="true">
        <Description>Generic &lt;T&gt; properly used for Authorize flow</Description>
        <Verification>Verify PaymentsAuthorizeData&lt;T&gt; and FiservemeaAuthorizeRequest&lt;T&gt; have generic</Verification>
      </Check>
      <Check id="VC10" required="true">
        <Description>Appropriate derive attributes on all structs</Description>
        <Verification>Check for Debug, Serialize, Deserialize as appropriate</Verification>
      </Check>
    </Category>

    <Category name="Status Mapping">
      <Check id="VC11" required="true">
        <Description>Status mapping function implemented</Description>
        <Verification>Verify map_fiservemea_status_to_attempt_status function exists</Verification>
      </Check>
      <Check id="VC12" required="true">
        <Description>Dedicated status enum created</Description>
        <Verification>Verify FiservemeaStatus enum exists with all API values</Verification>
      </Check>
      <Check id="VC13" required="true">
        <Description>No hardcoded status values</Description>
        <Verification>Search for hardcoded AttemptStatus values - should use mapping function</Verification>
      </Check>
      <Check id="VC14" required="true">
        <Description>All connector status values mapped</Description>
        <Verification>Compare FiservemeaStatus variants with API documentation</Verification>
      </Check>
    </Category>

    <Category name="Code Quality">
      <Check id="VC15" required="true">
        <Description>No unwrap() or expect() calls</Description>
        <Verification>Search for unwrap and expect in modified files</Verification>
      </Check>
      <Check id="VC16" required="true">
        <Description>No fields hardcoded to None</Description>
        <Verification>Review all struct fields for unnecessary Option wrappers</Verification>
      </Check>
      <Check id="VC17" required="true">
        <Description>Serde naming conventions followed</Description>
        <Verification>Check for snake_case fields with camelCase serde rename</Verification>
      </Check>
      <Check id="VC18" required="true">
        <Description>domain_types imports used</Description>
        <Verification>Verify no hyperswitch_* imports present</Verification>
      </Check>
      <Check id="VC19" required="true">
        <Description>RouterDataV2 used (not RouterData)</Description>
        <Verification>Search for RouterData usage - should be RouterDataV2</Verification>
      </Check>
    </Category>
  </ValidationChecklist>

  <!-- ========================================================= -->
  <!-- ABSOLUTE PROHIBITIONS                                     -->
  <!-- ========================================================= -->
  <AbsoluteProhibitions>
    <Prohibition id="P1" severity="critical">
      <Description>Implementing any flow other than Authorize</Description>
      <Consequence>INVALID_OUTPUT - Entire implementation rejected</Consequence>
    </Prohibition>
    <Prohibition id="P2" severity="critical">
      <Description>Manually implementing ConnectorIntegrationV2 trait</Description>
      <Consequence>INVALID_OUTPUT - Entire implementation rejected</Consequence>
    </Prohibition>
    <Prohibition id="P3" severity="critical">
      <Description>Modifying any core files</Description>
      <AllowedFiles>
        <File>fiservemea.rs</File>
        <File>fiservemea/transformers.rs</File>
      </AllowedFiles>
      <Consequence>INVALID_OUTPUT - Entire implementation rejected</Consequence>
    </Prohibition>
    <Prohibition id="P4" severity="high">
      <Description>Using mocked or hardcoded responses</Description>
      <Consequence>Code quality failure</Consequence>
    </Prohibition>
    <Prohibition id="P5" severity="high">
      <Description>Using unwrap() or expect() for error handling</Description>
      <Consequence>Code quality failure</Consequence>
    </Prohibition>
    <Prohibition id="P6" severity="high">
      <Description>Returning success on error conditions</Description>
      <Consequence>Functional failure</Consequence>
    </Prohibition>
    <Prohibition id="P7" severity="critical">
      <Description>Skipping macro-based approach</Description>
      <Consequence>INVALID_OUTPUT - Entire implementation rejected</Consequence>
    </Prohibition>
    <Prohibition id="P8" severity="medium">
      <Description>Adding fields "just in case" without API requirement</Description>
      <Consequence>Code review failure</Consequence>
    </Prohibition>
  </AbsoluteProhibitions>

  <!-- ========================================================= -->
  <!-- SUCCESS CRITERIA                                          -->
  <!-- ========================================================= -->
  <SuccessCriteria>
    <FunctionalCriteria>
      <Criterion>Authorize flow successfully processes payment authorization requests</Criterion>
      <Criterion>Request correctly transformed to FiservEMEA API format</Criterion>
      <Criterion>Response correctly transformed from FiservEMEA API format</Criterion>
      <Criterion>Status values correctly mapped to AttemptStatus enum</Criterion>
      <Criterion>Errors properly propagated through the error handling chain</Criterion>
    </FunctionalCriteria>
    <TechnicalCriteria>
      <Criterion>Code compiles without warnings</Criterion>
      <Criterion>All lint checks pass</Criterion>
      <Criterion>No clippy warnings</Criterion>
      <Criterion>Code follows Rust best practices</Criterion>
      <Criterion>Code is consistent with other UCS connector implementations</Criterion>
    </TechnicalCriteria>
    <ComplianceCriteria>
      <Criterion>All validation checklist items passed</Criterion>
      <Criterion>No absolute prohibitions violated</Criterion>
      <Criterion>All mandatory workflow phases completed</Criterion>
      <Criterion>All deliverables meet validation criteria</Criterion>
    </ComplianceCriteria>
  </SuccessCriteria>

  <!-- ========================================================= -->
  <!-- ASSUMPTIONS AND DEPENDENCIES                              -->
  <!-- ========================================================= -->
  <AssumptionsAndDependencies>
    <Assumptions>
      <Assumption>FiservEMEA technical specification is complete and accurate</Assumption>
      <Assumption>FiservEMEA API supports Authorize flow</Assumption>
      <Assumption>Required macro infrastructure is available and functional</Assumption>
      <Assumption>Airwallex connector represents current best practices</Assumption>
      <Assumption>Domain types and common enums are stable</Assumption>
    </Assumptions>
    <Dependencies>
      <Dependency>GRACE-UCS macro framework</Dependency>
      <Dependency>FiservEMEA API availability</Dependency>
      <Dependency>connector-interface crate</Dependency>
      <Dependency>domain-types crate</Dependency>
      <Dependency>common-enums crate</Dependency>
    </Dependencies>
  </AssumptionsAndDependencies>

  <!-- ========================================================= -->
  <!-- RISK MITIGATION                                           -->
  <!-- ========================================================= -->
  <RiskMitigation>
    <Risk>
      <Description>FiservEMEA API specification incomplete or unclear</Description>
      <Mitigation>Thoroughly review technical specification, clarify ambiguities before implementation</Mitigation>
    </Risk>
    <Risk>
      <Description>Macro usage misunderstood or misapplied</Description>
      <Mitigation>Study reference implementation (Airwallex) and macro documentation thoroughly</Mitigation>
    </Risk>
    <Risk>
      <Description>Status mapping incomplete or incorrect</Description>
      <Mitigation>Ensure all possible status values from API docs are covered in enum and mapping</Mitigation>
    </Risk>
    <Risk>
      <Description>Generic type &lt;T&gt; bounds incorrect</Description>
      <Mitigation>Follow Airwallex pattern for generic type bounds on Authorize flow</Mitigation>
    </Risk>
  </RiskMitigation>

  <!-- ========================================================= -->
  <!-- APPENDICES                                                -->
  <!-- ========================================================= -->
  <Appendices>
    <Appendix id="A1" name="Terminology">
      <Term name="UCS">
        <Definition>Unified Connector System - The framework for connector integrations</Definition>
      </Term>
      <Term name="GRACE">
        <Definition>The code generation and workflow controller system</Definition>
      </Term>
      <Term name="Authorize Flow">
        <Definition>Payment authorization flow that reserves funds without capturing them</Definition>
      </Term>
      <Term name="RouterDataV2">
        <Definition>The V2 router data structure containing flow information</Definition>
      </Term>
      <Term name="PaymentFlowData">
        <Definition>Resource common data type for payment-related flows</Definition>
      </Term>
    </Appendix>

    <Appendix id="A2" name="Related Documents">
      <Document>
        <Name>FiservEMEA Technical Specification</Name>
        <Path>fiservemea/technicalspecification.md</Path>
      </Document>
      <Document>
        <Name>Authorize Flow Pattern</Name>
        <Path>guides/patterns/pattern_authorize.md</Path>
      </Document>
      <Document>
        <Name>Macro Patterns Reference</Name>
        <Path>guides/patterns/macro_patterns_reference.md</Path>
      </Document>
      <Document>
        <Name>Flow Macro Guide</Name>
        <Path>guides/patterns/flow_macro_guide.md</Path>
      </Document>
      <Document>
        <Name>Macro Templates</Name>
        <Path>template-generation/macro_templates.md</Path>
      </Document>
    </Appendix>
  </Appendices>
</RequirementAnalysis>