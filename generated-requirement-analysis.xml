<?xml version="1.0" encoding="UTF-8"?>
<RequirementAnalysis>
  <Metadata>
    <ProjectName>GRACE-UCS Deterministic Workflow Rules</ProjectName>
    <Version>1.0.0</Version>
    <GeneratedDate>2026-02-06</GeneratedDate>
    <Purpose>Define deterministic, step-by-step workflow for new UCS connector integrations</Purpose>
  </Metadata>

  <ExecutiveSummary>
    <Description>
      The GRACE-UCS Deterministic Workflow Rules system provides a structured, phased approach for integrating new payment connectors into the Universal Connector System (UCS). This system enforces mandatory execution sequences, validates each phase before proceeding, and ensures code quality through automated checks and reviews.
    </Description>
    <KeyObjectives>
      <Objective>Standardize connector integration process</Objective>
      <Objective>Ensure code quality and UCS compliance</Objective>
      <Objective>Provide deterministic workflow with clear phase boundaries</Objective>
      <Objective>Eliminate ambiguity in integration steps</Objective>
      <Objective>Enforce mandatory validation at each phase</Objective>
    </KeyObjectives>
  </ExecutiveSummary>

  <Scope>
    <InScope>
      <Item>New connector integrations only</Item>
      <Item>Technical specification validation</Item>
      <Item>Foundation setup automation</Item>
      <Item>Flow implementation (Authorize, PSync, Capture, Void, Refund, RSync, Dispute)</Item>
      <Item>Macro-based code generation</Item>
      <Item>Quality assurance and validation</Item>
      <Item>Timeline tracking and reporting</Item>
    </InScope>
    <OutOfScope>
      <Item>Existing connector modifications</Item>
      <Item>Connector testing beyond compilation</Item>
      <Item>Production deployment</Item>
      <Item>Performance optimization</Item>
      <Item>Documentation generation</Item>
    </OutOfScope>
  </Scope>

  <Actors>
    <Actor>
      <Name>Main Workflow Controller</Name>
      <Role>Orchestrates the entire integration workflow</Role>
      <Responsibilities>
        <Responsibility>Initiate workflow on user command</Responsibility>
        <Responsibility>Coordinate between subagents</Responsibility>
        <Responsibility>Track timeline and phase completion</Responsibility>
        <Responsibility>Handle errors and retries</Responsibility>
        <Responsibility>Generate completion reports</Responsibility>
      </Responsibilities>
    </Actor>
    <Actor>
      <Name>Foundation Setup Subagent</Name>
      <Role>Establishes basic connector structure</Role>
      <Responsibilities>
        <Responsibility>Validate environment</Responsibility>
        <Responsibility>Analyze technical specifications</Responsibility>
        <Responsibility>Execute add_connector.sh script</Responsibility>
        <Responsibility>Validate cargo build</Responsibility>
        <Responsibility>Verify UCS conventions</Responsibility>
      </Responsibilities>
    </Actor>
    <Actor>
      <Name>Flow Implementation Subagent</Name>
      <Role>Implements individual payment flows</Role>
      <Responsibilities>
        <Responsibility>Read flow-specific patterns</Responsibility>
        <Responsibility>Generate implementation plans</Responsibility>
        <Responsibility>Implement flows using macros</Responsibility>
        <Responsibility>Create request/response transformers</Responsibility>
        <Responsibility>Validate flow compilation</Responsibility>
      </Responsibilities>
    </Actor>
    <Actor>
      <Name>Quality Guardian Subagent</Name>
      <Role>Performs comprehensive code quality review</Role>
      <Responsibilities>
        <Responsibility>Review code against UCS standards</Responsibility>
        <Responsibility>Validate error handling</Responsibility>
        <Responsibility>Check status mapping correctness</Responsibility>
        <Responsibility>Approve or reject implementation</Responsibility>
      </Responsibilities>
    </Actor>
    <Actor>
      <Name>User</Name>
      <Role>Initiates connector integration</Role>
      <Responsibilities>
        <Responsibility>Provide technical specification</Responsibility>
        <Responsibility>Run integration command</Responsibility>
        <Responsibility>Review completion report</Responsibility>
      </Responsibilities>
    </Actor>
  </Actors>

  <FunctionalRequirements>
    <Requirement id="FR-001" priority="MUST">
      <Title>Workflow Trigger Command</Title>
      <Description>The system must respond to the command: "integrate {ConnectorName} using grace/rulesbook/codegen/.gracerules"</Description>
      <AcceptanceCriteria>
        <Criterion>Command initiates Phase 1 immediately</Criterion>
        <Criterion>ConnectorName parameter is validated</Criterion>
        <Criterion>Technical specification file existence is verified</Criterion>
      </AcceptanceCriteria>
    </Requirement>

    <Requirement id="FR-002" priority="MUST">
      <Title>Phase 1: Technical Specification Validation</Title>
      <Description>System must read and validate the technical specification from grace/rulesbook/codegen/references/{connector_name}/technical_specification.md</Description>
      <AcceptanceCriteria>
        <Criterion>Read technical specification file</Criterion>
        <Criterion>Validate completeness of specification</Criterion>
        <Criterion>Validate UCS compatibility</Criterion>
        <Criterion>Extract all connector requirements</Criterion>
        <Criterion>Extract supported features</Criterion>
        <Criterion>Log phase completion with timeline.log_phase_end()</Criterion>
      </AcceptanceCriteria>
    </Requirement>

    <Requirement id="FR-003" priority="MUST">
      <Title>Phase 2: Foundation Setup</Title>
      <Description>System must establish the basic connector structure through Foundation Setup Subagent</Description>
      <AcceptanceCriteria>
        <Criterion>Validate environment and repository structure</Criterion>
        <Criterion>Verify add_connector.sh script exists</Criterion>
        <Criterion>Verify backend/ directory structure exists</Criterion>
        <Criterion>Extract connector_name and base_url from tech spec</Criterion>
        <Criterion>Execute add_connector.sh with correct parameters</Criterion>
        <Criterion>Wait for completion confirmation</Criterion>
        <Criterion>Validate cargo build success</Criterion>
        <Criterion>Log phase completion with timeline.log_phase_end()</Criterion>
      </AcceptanceCriteria>
    </Requirement>

    <Requirement id="FR-004" priority="MUST">
      <Title>Phase 2.5: Macro Pattern Reference Study</Title>
      <Description>System must read and understand macro pattern guides before implementation</Description>
      <AcceptanceCriteria>
        <Criterion>Read guides/patterns/macro_patterns_reference.md</Criterion>
        <Criterion>Read guides/patterns/flow_macro_guide.md</Criterion>
        <Criterion>Read template-generation/macro_templates.md</Criterion>
        <Criterion>Understand create_all_prerequisites! macro usage</Criterion>
        <Criterion>Understand macro_connector_implementation! macro usage</Criterion>
        <Criterion>Understand flow-specific macro configurations</Criterion>
        <Criterion>Understand request/response type naming conventions</Criterion>
        <Criterion>Understand when to use generic &lt;T&gt; types</Criterion>
        <Criterion>Understand resource common data selection</Criterion>
        <Criterion>Log phase completion with timeline.log_phase_end()</Criterion>
      </AcceptanceCriteria>
    </Requirement>

    <Requirement id="FR-005" priority="MUST">
      <Title>Phase 3: Flow Implementation</Title>
      <Description>System must implement flows in exact sequence, each completing before the next begins</Description>
      <AcceptanceCriteria>
        <Criterion>Implement Authorize flow first</Criterion>
        <Criterion>Each flow reads tech spec</Criterion>
        <Criterion>Each flow reads corresponding pattern file</Criterion>
        <Criterion>Each flow reads available utils and enums</Criterion>
        <Criterion>Each flow generates implementation plan</Criterion>
        <Criterion>Each flow uses macro-based approach</Criterion>
        <Criterion>Each flow validates cargo build</Criterion>
        <Criterion>Flows execute in mandatory sequence</Criterion>
      </AcceptanceCriteria>
    </Requirement>

    <Requirement id="FR-006" priority="MUST">
      <Title>Authorize Flow Implementation</Title>
      <Description>System must implement the Authorize flow following UCS patterns</Description>
      <AcceptanceCriteria>
        <Criterion>Read guides/patterns/pattern_authorize.md</Criterion>
        <Criterion>Add flow to create_all_prerequisites! macro</Criterion>
        <Criterion>Implement with macro_connector_implementation!</Criterion>
        <Criterion>Create AuthorizeRequest struct in transformers.rs</Criterion>
        <Criterion>Create AuthorizeResponse struct in transformers.rs</Criterion>
        <Criterion>Implement request transformer TryFrom</Criterion>
        <Criterion>Implement response transformer TryFrom</Criterion>
        <Criterion>Add status mapping function</Criterion>
        <Criterion>Validate cargo build success</Criterion>
      </AcceptanceCriteria>
    </Requirement>

    <Requirement id="FR-007" priority="MUST">
      <Title>Macro-Based Implementation Requirement</Title>
      <Description>All flow implementations MUST use macro-based patterns, not manual trait implementations</Description>
      <AcceptanceCriteria>
        <Criterion>Never manually implement ConnectorIntegrationV2</Criterion>
        <Criterion>Always add flow to create_all_prerequisites! first</Criterion>
        <Criterion>Always use macro_connector_implementation! for implementation</Criterion>
        <Criterion>Flow names must match exactly in both macros</Criterion>
        <Criterion>Request/Response types must match between macro and transformers</Criterion>
      </AcceptanceCriteria>
    </Requirement>

    <Requirement id="FR-008" priority="MUST">
      <Title>create_all_prerequisites! Macro Configuration</Title>
      <Description>System must correctly configure the create_all_prerequisites! macro for each flow</Description>
      <AcceptanceCriteria>
        <Criterion>Add flow definition to api: [] array</Criterion>
        <Criterion>Specify correct flow name</Criterion>
        <Criterion>Specify correct request_body type (omit for GET)</Criterion>
        <Criterion>Specify correct response_body type</Criterion>
        <Criterion>Specify correct router_data type with generics</Criterion>
        <Criterion>Use PaymentFlowData for Authorize/PSync/Capture/Void</Criterion>
        <Criterion>Use RefundFlowData for Refund/RSync</Criterion>
        <Criterion>Use DisputeFlowData for dispute flows</Criterion>
        <Criterion>Use correct RequestData type for each flow</Criterion>
        <Criterion>Use correct ResponseData type for each flow</Criterion>
      </AcceptanceCriteria>
    </Requirement>

    <Requirement id="FR-009" priority="MUST">
      <Title>macro_connector_implementation! Configuration</Title>
      <Description>System must correctly configure the macro_connector_implementation! macro for each flow</Description>
      <AcceptanceCriteria>
        <Criterion>Specify connector_default_implementations array</Criterion>
        <Criterion>Specify connector name</Criterion>
        <Criterion>Specify correct curl_request type (Json, FormData, FormUrlEncoded, or omit)</Criterion>
        <Criterion>Specify correct curl_response type</Criterion>
        <Criterion>Specify correct flow_name</Criterion>
        <Criterion>Specify correct resource_common_data</Criterion>
        <Criterion>Specify correct flow_request type</Criterion>
        <Criterion>Specify correct flow_response type</Criterion>
        <Criterion>Specify correct http_method (Post, Get, Put, Delete)</Criterion>
        <Criterion>Specify generic_type: T</Criterion>
        <Criterion>Specify trait bounds for T</Criterion>
        <Criterion>Implement get_headers function in other_functions</Criterion>
        <Criterion>Implement get_url function in other_functions</Criterion>
        <Criterion>Extract endpoint from tech spec</Criterion>
      </AcceptanceCriteria>
    </Requirement>

    <Requirement id="FR-010" priority="MUST">
      <Title>Request/Response Type Creation</Title>
      <Description>System must create proper request and response types in transformers.rs</Description>
      <AcceptanceCriteria>
        <Criterion>Define request struct with Debug and Serialize derives</Criterion>
        <Criterion>Define response struct with Debug and Deserialize derives</Criterion>
        <Criterion>Include only fields from API documentation</Criterion>
        <Criterion>Remove fields that will always be None</Criterion>
        <Criterion>Use Option only for truly optional fields per API spec</Criterion>
        <Criterion>Create enums for status fields instead of String</Criterion>
        <Criterion>Use correct amount type from amount_converter</Criterion>
        <Criterion>Include payment_method field when needed</Criterion>
      </AcceptanceCriteria>
    </Requirement>

    <Requirement id="FR-011" priority="MUST">
      <Title>Request Transformer Implementation</Title>
      <Description>System must implement TryFrom trait for request transformation</Description>
      <AcceptanceCriteria>
        <Criterion>Implement TryFrom for {ConnectorName}RouterData&lt;RouterDataV2&lt;...&gt;, T&gt;</Criterion>
        <Criterion>Extract router_data from input</Criterion>
        <Criterion>Transform data according to connector API requirements</Criterion>
        <Criterion>Use specific NotSupported errors with exact feature names</Criterion>
        <Criterion>Only populate fields that exist in the struct</Criterion>
        <Criterion>Never set any field to None - remove field instead</Criterion>
      </AcceptanceCriteria>
    </Requirement>

    <Requirement id="FR-012" priority="MUST">
      <Title>Response Transformer Implementation</Title>
      <Description>System must implement TryFrom trait for response transformation</Description>
      <AcceptanceCriteria>
        <Criterion>Implement TryFrom for ResponseRouterData&lt;{ConnectorName}{FlowName}Response, RouterDataV2&lt;...&gt;&gt;</Criterion>
        <Criterion>Map response to RouterDataV2</Criterion>
        <Criterion>NEVER hardcode status values</Criterion>
        <Criterion>ALWAYS derive status from response using mapping function</Criterion>
        <Criterion>Return updated router_data</Criterion>
      </AcceptanceCriteria>
    </Requirement>

    <Requirement id="FR-013" priority="MUST">
      <Title>Status Mapping Implementation</Title>
      <Description>System must create proper status mapping functions for each connector</Description>
      <AcceptanceCriteria>
        <Criterion>Create dedicated status enum (e.g., {ConnectorName}Status)</Criterion>
        <Criterion>Create mapping function returning common_enums::AttemptStatus</Criterion>
        <Criterion>Map ALL possible connector status values from API docs</Criterion>
        <Criterion>NEVER leave status variants unmapped</Criterion>
        <Criterion>ALWAYS use mapping function in response transformers</Criterion>
        <Criterion>NEVER hardcode AttemptStatus values directly</Criterion>
      </AcceptanceCriteria>
    </Requirement>

    <Requirement id="FR-014" priority="MUST">
      <Title>Phase 4: Final Validation and Quality Review</Title>
      <Description>System must perform final validation and delegate to Quality Guardian Subagent</Description>
      <AcceptanceCriteria>
        <Criterion>Execute final cargo build</Criterion>
        <Criterion>Validate all flows compile successfully</Criterion>
        <Criterion>Delegate to Quality Guardian Subagent</Criterion>
        <Criterion>Wait for quality review completion and approval</Criterion>
        <Criterion>Generate completion report</Criterion>
        <Criterion>Log phase completion with timeline.log_phase_end()</Criterion>
        <Criterion>Execute timeline.finalize() as final step</Criterion>
      </AcceptanceCriteria>
    </Requirement>

    <Requirement id="FR-015" priority="MUST">
      <Title>Timeline Tracking</Title>
      <Description>System must track timeline events throughout the workflow</Description>
      <AcceptanceCriteria>
        <Criterion>Log phase_1_tech_spec_validation end</Criterion>
        <Criterion>Log phase_2_foundation_setup end</Criterion>
        <Criterion>Log phase_2_5_macro_pattern_study end</Criterion>
        <Criterion>Log phase_4_quality_review end</Criterion>
        <Criterion>Execute timeline.finalize() at workflow completion</Criterion>
        <Criterion>Include status parameter (success/failure) in all logs</Criterion>
      </AcceptanceCriteria>
    </Requirement>

    <Requirement id="FR-016" priority="MUST">
      <Title>Error Handling</Title>
      <Description>System must handle errors appropriately at each phase</Description>
      <AcceptanceCriteria>
        <Criterion>Stop on any failure</Criterion>
        <Criterion>Analyze error and explain failure reason</Criterion>
        <Criterion>Propose next step for recovery</Criterion>
        <Criterion>Wait for confirmation before retrying</Criterion>
        <Criterion>Never proceed to next phase until current phase succeeds</Criterion>
      </AcceptanceCriteria>
    </Requirement>

    <Requirement id="FR-017" priority="MUST">
      <Title>Foundation Setup Error Handling</Title>
      <Description>Foundation Setup Subagent must handle specific errors</Description>
      <AcceptanceCriteria>
        <Criterion>If add_connector.sh fails: analyze error, fix prerequisites, retry</Criterion>
        <Criterion>If cargo build fails: analyze errors, fix using UCS patterns, retry</Criterion>
        <Criterion>If convention validation fails: fix code to match UCS requirements</Criterion>
        <Criterion>Never proceed until all steps complete successfully</Criterion>
      </AcceptanceCriteria>
    </Requirement>

    <Requirement id="FR-018" priority="MUST">
      <Title>Flow Implementation Error Handling</Title>
      <Description>Flow Implementation Subagent must handle compilation errors</Description>
      <AcceptanceCriteria>
        <Criterion>Execute cargo build after each flow</Criterion>
        <Criterion>If compilation errors occur, analyze and fix immediately</Criterion>
        <Criterion>Ensure all UCS conventions are followed</Criterion>
        <Criterion>Verify no syntax or type errors</Criterion>
        <Criterion>Achieve successful build before flow completion</Criterion>
      </AcceptanceCriteria>
    </Requirement>

    <Requirement id="FR-019" priority="MUST">
      <Title>UCS Convention Compliance</Title>
      <Description>System must ensure all code follows UCS conventions</Description>
      <AcceptanceCriteria>
        <Criterion>Use RouterDataV2 (not RouterData)</Criterion>
        <Criterion>Use ConnectorIntegrationV2 (not ConnectorIntegration)</Criterion>
        <Criterion>Use domain_types imports (not hyperswitch_domain_models)</Criterion>
        <Criterion>Use generic struct pattern: ConnectorName&lt;T&gt;</Criterion>
        <Criterion>Follow UCS naming conventions</Criterion>
        <Criterion>Reuse existing utils and enums</Criterion>
      </AcceptanceCriteria>
    </Requirement>

    <Requirement id="FR-020" priority="MUST">
      <Title>Code Quality Rules</Title>
      <Description>System must enforce critical code quality rules</Description>
      <AcceptanceCriteria>
        <Criterion>Remove all fields hardcoded to None</Criterion>
        <Criterion>Don't use Option unless field is truly optional per API spec</Criterion>
        <Criterion>Never hardcode status - always derive from connector response</Criterion>
        <Criterion>Use specific NotSupported errors with exact feature names</Criterion>
        <Criterion>Only validate what's required by connector API</Criterion>
        <Criterion>Add comments explaining validation logic</Criterion>
        <Criterion>Only include fields actually used by connector API</Criterion>
      </AcceptanceCriteria>
    </Requirement>

    <Requirement id="FR-021" priority="MUST">
      <Title>Utils and Enums Reading</Title>
      <Description>Flow Implementation Subagent must read available utils and enums</Description>
      <AcceptanceCriteria>
        <Criterion>Read backend/grpc-server/src/utils.rs</Criterion>
        <Criterion>Read backend/domain_types/src/utils.rs</Criterion>
        <Criterion>Read backend/connector-integration/src/utils.rs</Criterion>
        <Criterion>Read backend/common_enums/src/enums.rs</Criterion>
        <Criterion>Study and reuse existing utils and enums</Criterion>
      </AcceptanceCriteria>
    </Requirement>

    <Requirement id="FR-022" priority="MUST">
      <Title>GET Endpoint Handling</Title>
      <Description>System must handle GET endpoints correctly in macro configuration</Description>
      <AcceptanceCriteria>
        <Criterion>Omit curl_request parameter for GET endpoints</Criterion>
        <Criterion>Specify http_method: Get in macro_connector_implementation!</Criterion>
        <Criterion>Request body type omitted in create_all_prerequisites!</Criterion>
        <Criterion>URL construction includes query parameters if needed</Criterion>
      </AcceptanceCriteria>
    </Requirement>

    <Requirement id="FR-023" priority="MUST">
      <Title>POST/PUT/DELETE Endpoint Handling</Title>
      <Description>System must handle POST, PUT, DELETE endpoints correctly in macro configuration</Description>
      <AcceptanceCriteria>
        <Criterion>Include curl_request parameter for POST/PUT/DELETE</Criterion>
        <Criterion>Specify correct http_method in macro_connector_implementation!</Criterion>
        <Criterion>Use Json for JSON APIs</Criterion>
        <Criterion>Use FormData for multipart form data</Criterion>
        <Criterion>Use FormUrlEncoded for URL-encoded forms</Criterion>
      </AcceptanceCriteria>
    </Requirement>

    <Requirement id="FR-024" priority="MUST">
      <Title>Generic Type Usage</Title>
      <Description>System must correctly use generic &lt;T&gt; types where required</Description>
      <AcceptanceCriteria>
        <Criterion>Use generic &lt;T&gt; for Authorize flow</Criterion>
        <Criterion>Use generic &lt;T&gt; for flows using payment method data</Criterion>
        <Criterion>Specify trait bounds: PaymentMethodDataTypes + Debug + Sync + Send + 'static + Serialize</Criterion>
        <Criterion>Apply generic type to request structs</Criterion>
        <Criterion>Apply generic type to transformer implementations</Criterion>
      </AcceptanceCriteria>
    </Requirement>

    <Requirement id="FR-025" priority="MUST">
      <Title>Completion Report Generation</Title>
      <Description>System must generate a comprehensive completion report</Description>
      <AcceptanceCriteria>
        <Criterion>List all files created</Criterion>
        <Criterion>List all files modified</Criterion>
        <Criterion>Document all flows implemented</Criterion>
        <Criterion>Include cargo build status</Criterion>
        <Criterion>Include quality review results</Criterion>
        <Criterion>Include timeline summary</Criterion>
        <Criterion>Include any warnings or notes</Criterion>
      </AcceptanceCriteria>
    </Requirement>

    <Requirement id="FR-026" priority="MUST">
      <Title>Final Resolution Step</Title>
      <Description>System must mark requirement analysis as resolved upon completion</Description>
      <AcceptanceCriteria>
        <Criterion>Execute as final step after all tasks complete</Criterion>
        <Criterion>Rename generated-requirement-analysis.xml to generated-requirement-analysis.xml.resolved</Criterion>
        <Criterion>Confirm all requirements have been addressed</Criterion>
        <Criterion>Confirm all phases completed successfully</Criterion>
      </AcceptanceCriteria>
    </Requirement>
  </FunctionalRequirements>

  <NonFunctionalRequirements>
    <Requirement id="NFR-001" priority="MUST">
      <Title>Deterministic Execution</Title>
      <Description>Workflow must execute in deterministic, predictable manner</Description>
      <Metric>100% of executions follow same sequence</Metric>
    </Requirement>

    <Requirement id="NFR-002" priority="MUST">
      <Title>Phase Sequentiality</Title>
      <Description>Phases must execute in strict sequential order</Description>
      <Metric>No phase starts before previous phase completes</Metric>
    </Requirement>

    <Requirement id="NFR-003" priority="MUST">
      <Title>Mandatory Step Enforcement</Title>
      <Description>All mandatory steps must be completed</Description>
      <Metric>100% of mandatory steps executed</Metric>
    </Requirement>

    <Requirement id="NFR-004" priority="MUST">
      <Title>Compilation Success</Title>
      <Description>Project must compile without errors</Description>
      <Metric>cargo build exits with code 0</Metric>
    </Requirement>

    <Requirement id="NFR-005" priority="MUST">
      <Title>Single Binary Output</Title>
      <Description>Project must produce single binary, not multiple</Description>
      <Metric>Only one binary target in Cargo.toml</Metric>
    </Requirement>

    <Requirement id="NFR-006" priority="MUST">
      <Title>No Mock Implementations</Title>
      <Description>Code must be production-ready with no mocks or TODOs</Description>
      <Metric>0 TODO/FIXME comments in generated code</Metric>
    </Requirement>

    <Requirement id="NFR-007" priority="MUST">
      <Title>Database Schema Consistency</Title>
      <Description>Database schema must be consistent with requirements</Description>
      <Metric>Schema matches all data structures defined</Metric>
    </Requirement>

    <Requirement id="NFR-008" priority="SHOULD">
      <Title>Error Message Clarity</Title>
      <Description>Error messages must be clear and actionable</Description>
      <Metric>Error messages include failure reason and proposed fix</Metric>
    </Requirement>

    <Requirement id="NFR-009" priority="SHOULD">
      <Title>Progress Visibility</Title>
      <Description>Progress must be visible throughout workflow</Description>
      <Metric>Status updates provided at each phase boundary</Metric>
    </Requirement>

    <Requirement id="NFR-010" priority="COULD">
      <Title>Execution Time</Title>
      <Description>Workflow should complete in reasonable time</Description>
      <Metric>Full integration &lt; 30 minutes for typical connector</Metric>
    </Requirement>
  </NonFunctionalRequirements>

  <DataRequirements>
    <DataEntity id="DR-001">
      <Name>Technical Specification</Name>
      <Location>grace/rulesbook/codegen/references/{connector_name}/technical_specification.md</Location>
      <RequiredFields>
        <Field>connector_name</Field>
        <Field>base_url</Field>
        <Field>API endpoints</Field>
        <Field>Authentication method</Field>
        <Field>Supported payment methods</Field>
        <Field>Supported flows</Field>
        <Field>Request/response schemas</Field>
        <Field>Status codes and meanings</Field>
      </RequiredFields>
    </DataEntity>

    <DataEntity id="DR-002">
      <Name>RouterDataV2</Name>
      <Description>Primary data structure for routing payment requests</Description>
      <Generics>&lt;Flow, FlowData, RequestData, ResponseData&gt;</Generics>
      <Usage>Used across all flow implementations</Usage>
    </DataEntity>

    <DataEntity id="DR-003">
      <Name>PaymentFlowData</Name>
      <Description>Common data for payment-related flows</Description>
      <UsedInFlows>Authorize, PSync, Capture, Void</UsedInFlows>
    </DataEntity>

    <DataEntity id="DR-004">
      <Name>RefundFlowData</Name>
      <Description>Common data for refund-related flows</Description>
      <UsedInFlows>Refund, RSync</UsedInFlows>
    </DataEntity>

    <DataEntity id="DR-005">
      <Name>DisputeFlowData</Name>
      <Description>Common data for dispute-related flows</Description>
      <UsedInFlows>All dispute flows</UsedInFlows>
    </DataEntity>

    <DataEntity id="DR-006">
      <Name>Connector Status Enum</Name>
      <Description>Enum representing connector-specific status values</Description>
      <NamingConvention>{ConnectorName}Status</NamingConvention>
      <MappingRequired>true</MappingRequired>
    </DataEntity>

    <DataEntity id="DR-007">
      <Name>Request Types</Name>
      <Description>Request structures for each flow</Description>
      <NamingConvention>{ConnectorName}{FlowName}Request&lt;T&gt;</NamingConvention>
      <Derives>Debug, Serialize</Derives>
    </DataEntity>

    <DataEntity id="DR-008">
      <Name>Response Types</Name>
      <Description>Response structures for each flow</Description>
      <NamingConvention>{ConnectorName}{FlowName}Response</NamingConvention>
      <Derives>Debug, Deserialize</Derives>
    </DataEntity>

    <DataEntity id="DR-009">
      <Name>Timeline Log</Name>
      <Description>Tracks phase completion and timing</Description>
      <Methods>
        <Method>log_phase_end(phase_name, status)</Method>
        <Method>finalize()</Method>
      </Methods>
    </DataEntity>
  </DataRequirements>

  <InterfaceRequirements>
    <Interface id="IR-001">
      <Name>Workflow Trigger Interface</Name>
      <Type>Command Line</Type>
      <Format>integrate {ConnectorName} using grace/rulesbook/codegen/.gracerules</Format>
      <Input>
        <Parameter>ConnectorName - Name of connector to integrate</Parameter>
      </Input>
      <Output>Workflow initiation confirmation</Output>
    </Interface>

    <Interface id="IR-002">
      <Name>Foundation Setup Interface</Name>
      <Type>Script Execution</Type>
      <Command>./add_connector.sh {connector_name} {base_url} --force -y</Command>
      <Input>
        <Parameter>connector_name - From tech spec</Parameter>
        <Parameter>base_url - From tech spec</Parameter>
      </Input>
      <Output>Connector structure files</Output>
    </Interface>

    <Interface id="IR-003">
      <Name>Cargo Build Interface</Name>
      <Type>Build System</Type>
      <Command>cargo build</Command>
      <Output>Compilation success/failure</Output>
    </Interface>

    <Interface id="IR-004">
      <Name>Macro Interface</Name>
      <Type>Code Generation</Type>
      <Macros>
        <Macro>create_all_prerequisites!</Macro>
        <Macro>macro_connector_implementation!</Macro>
      </Macros>
    </Interface>

    <Interface id="IR-005">
      <Name>Transformer Interface</Name>
      <Type>Trait Implementation</Type>
      <Trait>TryFrom</Trait>
      <Implementations>
        <Implementation>Request transformer</Implementation>
        <Implementation>Response transformer</Implementation>
      </Implementations>
    </Interface>

    <Interface id="IR-006">
      <Name>Quality Review Interface</Name>
      <Type>Subagent Communication</Type>
      <Input>Complete codebase for review</Input>
      <Output>Approval or rejection with feedback</Output>
    </Interface>
  </InterfaceRequirements>

  <WorkflowPhases>
    <Phase id="P-001" sequence="1">
      <Name>Technical Specification Validation</Name>
      <Trigger>Workflow initiation command</Trigger>
      <Steps>
        <Step sequence="1">Read tech spec from grace/rulesbook/codegen/references/{connector_name}/technical_specification.md</Step>
        <Step sequence="2">Validate tech spec completeness</Step>
        <Step sequence="3">Validate UCS compatibility</Step>
        <Step sequence="4">Extract all connector requirements</Step>
        <Step sequence="5">Extract supported features</Step>
        <Step sequence="6">Log phase completion: timeline.log_phase_end("phase_1_tech_spec_validation", status="success")</Step>
      </Steps>
      <ExitCriteria>Tech spec validated and logged</ExitCriteria>
      <ErrorHandler>Analyze failure, explain reason, propose fix, wait for confirmation</ErrorHandler>
    </Phase>

    <Phase id="P-002" sequence="2">
      <Name>Foundation Setup</Name>
      <Trigger>Phase 1 completion</Trigger>
      <ResponsibleAgent>Foundation Setup Subagent</ResponsibleAgent>
      <Steps>
        <Step sequence="1">Validate environment and repository structure</Step>
        <Step sequence="2">Verify add_connector.sh script exists</Step>
        <Step sequence="3">Verify backend/ directory structure exists</Step>
        <Step sequence="4">Read tech spec and extract connector_name and base_url</Step>
        <Step sequence="5">Execute add_connector.sh {connector_name} {base_url} --force -y</Step>
        <Step sequence="6">Wait for completion confirmation</Step>
        <Step sequence="7">Execute cargo build</Step>
        <Step sequence="8">Validate UCS conventions (RouterDataV2, ConnectorIntegrationV2, domain_types)</Step>
        <Step sequence="9">Log phase completion: timeline.log_phase_end("phase_2_foundation_setup", status="success")</Step>
      </Steps>
      <ExitCriteria>Foundation setup complete, cargo build successful, UCS conventions validated</ExitCriteria>
      <ErrorHandler>
        <Condition>add_connector.sh fails</Condition>
        <Action>Analyze error, fix prerequisites, retry</Action>
        <Condition>cargo build fails</Condition>
        <Action>Analyze errors, fix using UCS patterns, retry</Action>
        <Condition>Convention validation fails</Condition>
        <Action>Fix code to match UCS requirements</Action>
      </ErrorHandler>
    </Phase>

    <Phase id="P-003" sequence="3">
      <Name>Macro Pattern Reference Study</Name>
      <Trigger>Phase 2 completion</Trigger>
      <Steps>
        <Step sequence="1">Read guides/patterns/macro_patterns_reference.md</Step>
        <Step sequence="2">Read guides/patterns/flow_macro_guide.md</Step>
        <Step sequence="3">Read template-generation/macro_templates.md</Step>
        <Step sequence="4">Understand create_all_prerequisites! macro usage</Step>
        <Step sequence="5">Understand macro_connector_implementation! macro usage</Step>
        <Step sequence="6">Understand flow-specific macro configurations</Step>
        <Step sequence="7">Understand request/response type naming conventions</Step>
        <Step sequence="8">Understand when to use generic &lt;T&gt; types</Step>
        <Step sequence="9">Understand resource common data selection</Step>
        <Step sequence="10">Log phase completion: timeline.log_phase_end("phase_2_5_macro_pattern_study", status="success")</Step>
      </Steps>
      <ExitCriteria>All macro patterns understood and documented</ExitCriteria>
      <ErrorHandler>Analyze failure, explain reason, propose fix, wait for confirmation</ErrorHandler>
    </Phase>

    <Phase id="P-004" sequence="4">
      <Name>Flow Implementation</Name>
      <Trigger>Phase 3 completion</Trigger>
      <ResponsibleAgent>Flow Implementation Subagent</ResponsibleAgent>
      <SubPhases>
        <SubPhase id="SP-001" sequence="1">
          <Name>Authorize Flow</Name>
          <Steps>
            <Step sequence="1">Read tech spec</Step>
            <Step sequence="2">Read guides/patterns/pattern_authorize.md</Step>
            <Step sequence="3">Read utils and enums files</Step>
            <Step sequence="4">Generate implementation plan</Step>
            <Step sequence="5">Add Authorize to create_all_prerequisites! macro</Step>
            <Step sequence="6">Implement with macro_connector_implementation!</Step>
            <Step sequence="7">Create AuthorizeRequest and AuthorizeResponse types</Step>
            <Step sequence="8">Implement request and response transformers</Step>
            <Step sequence="9">Create status mapping function</Step>
            <Step sequence="10">Execute cargo build</Step>
            <Step sequence="11">Confirm flow completion</Step>
          </Steps>
        </SubPhase>
      </SubPhases>
      <ExitCriteria>All flows implemented and compiled successfully</ExitCriteria>
      <ErrorHandler>
        <Condition>Compilation errors</Condition>
        <Action>Analyze and fix immediately, ensure UCS conventions, retry build</Action>
      </ErrorHandler>
    </Phase>

    <Phase id="P-005" sequence="5">
      <Name>Final Validation and Quality Review</Name>
      <Trigger>Phase 4 completion</Trigger>
      <Steps>
        <Step sequence="1">Execute final cargo build</Step>
        <Step sequence="2">Validate all flows compile successfully</Step>
        <Step sequence="3">Delegate to Quality Guardian Subagent</Step>
        <Step sequence="4">Wait for quality review completion and approval</Step>
        <Step sequence="5">Generate completion report</Step>
        <Step sequence="6">Log phase completion: timeline.log_phase_end("phase_4_quality_review", status="success")</Step>
        <Step sequence="7">Execute timeline.finalize()</Step>
      </Steps>
      <ExitCriteria>Quality review approved, completion report generated, timeline finalized</ExitCriteria>
      <ErrorHandler>Analyze failure, explain reason, propose fix, wait for confirmation</ErrorHandler>
    </Phase>

    <Phase id="P-006" sequence="6">
      <Name>Resolution</Name>
      <Trigger>Phase 5 completion</Trigger>
      <Steps>
        <Step sequence="1">Confirm all requirements addressed</Step>
        <Step sequence="2">Confirm all phases completed successfully</Step>
        <Step sequence="3">Rename generated-requirement-analysis.xml to generated-requirement-analysis.xml.resolved</Step>
      </Steps>
      <ExitCriteria>Requirement analysis marked as resolved</ExitCriteria>
    </Phase>
  </WorkflowPhases>

  <FileStructure>
    <File path="grace/rulesbook/codegen/references/{connector_name}/technical_specification.md">
      <Purpose>Contains connector technical specification</Purpose>
      <Required>true</Required>
    </File>
    <File path="guides/patterns/macro_patterns_reference.md">
      <Purpose>Macro pattern reference guide</Purpose>
      <Required>true</Required>
    </File>
    <File path="guides/patterns/flow_macro_guide.md">
      <Purpose>Flow-specific macro guide</Purpose>
      <Required>true</Required>
    </File>
    <File path="template-generation/macro_templates.md">
      <Purpose>Macro template documentation</Purpose>
      <Required>true</Required>
    </File>
    <File path="guides/patterns/pattern_authorize.md">
      <Purpose>Authorize flow pattern reference</Purpose>
      <Required>true</Required>
    </File>
    <File path="backend/grpc-server/src/utils.rs">
      <Purpose>Utility functions for gRPC server</Purpose>
      <Required>true</Required>
    </File>
    <File path="backend/domain_types/src/utils.rs">
      <Purpose>Domain type utilities</Purpose>
      <Required>true</Required>
    </File>
    <File path="backend/connector-integration/src/utils.rs">
      <Purpose>Connector integration utilities</Purpose>
      <Required>true</Required>
    </File>
    <File path="backend/common_enums/src/enums.rs">
      <Purpose>Common enumerations</Purpose>
      <Required>true</Required>
    </File>
    <File path="backend/connector-integration/src/connectors/{connector_name}.rs">
      <Purpose>Main connector implementation file</Purpose>
      <CreatedDuring>Phase 2</CreatedDuring>
    </File>
    <File path="backend/connector-integration/src/connectors/{connector_name}/transformers.rs">
      <Purpose>Request/response transformers</Purpose>
      <CreatedDuring>Phase 2</CreatedDuring>
      <ModifiedDuring>Phase 4</ModifiedDuring>
    </File>
    <File path="add_connector.sh">
      <Purpose>Connector setup script</Purpose>
      <Required>true</Required>
    </File>
    <File path="generated-requirement-analysis.xml">
      <Purpose>This requirement analysis document</Purpose>
      <Initial>true</Initial>
    </File>
    <File path="generated-requirement-analysis.xml.resolved">
      <Purpose>Marked as resolved when workflow completes</Purpose>
      <CreatedDuring>Phase 6</CreatedDuring>
    </File>
  </FileStructure>

  <Constraints>
    <Constraint id="C-001" type="MUST">
      <Title>Sequential Phase Execution</Title>
      <Description>Phases must execute in exact sequence specified</Description>
      <Rationale>Ensures dependencies are satisfied and validation occurs at appropriate points</Rationale>
    </Constraint>

    <Constraint id="C-002" type="MUST">
      <Title>Mandatory Step Completion</Title>
      <Description>All steps marked MANDATORY must complete successfully</Description>
      <Rationale>Ensures no critical steps are skipped</Rationale>
    </Constraint>

    <Constraint id="C-003" type="MUST">
      <Title>Macro-Based Implementation</Title>
      <Description>Flow implementations must use macros, not manual trait implementation</Description>
      <Rationale>Ensures consistency and reduces boilerplate</Rationale>
    </Constraint>

    <Constraint id="C-004" type="MUST">
      <Title>Single Binary Project</Title>
      <Description>Project must not create multiple binaries</Description>
      <Rationale>Prevents cargo run confusion</Rationale>
    </Constraint>

    <Constraint id="C-005" type="MUST">
      <Title>Compilation Success</Title>
      <Description>Project must compile and run without errors</Description>
      <Rationale>Production-ready code requirement</Rationale>
    </Constraint>

    <Constraint id="C-006" type="MUST">
      <Title>No Mock Implementations</Title>
      <Description>No TODOs or mock implementations in final code</Description>
      <Rationale>Production-ready code requirement</Rationale>
    </Constraint>

    <Constraint id="C-007" type="MUST">
      <Title>Database Schema Consistency</Title>
      <Description>Database and schema must be consistent with requirements</Description>
      <Rationale>Data integrity requirement</Rationale>
    </Constraint>

    <Constraint id="C-008" type="MUST">
      <Title>UCS Convention Adherence</Title>
      <Code>Must use RouterDataV2, ConnectorIntegrationV2, domain_types</Code>
      <Rationale>Consistency across UCS codebase</Rationale>
    </Constraint>

    <Constraint id="C-009" type="MUST">
      <Title>Status Derivation</Title>
      <Description>Status must always be derived from connector response, never hardcoded</Description>
      <Rationale>Accurate payment status tracking</Rationale>
    </Constraint>

    <Constraint id="C-010" type="MUST">
      <Title>Error Specificity</Title>
      <Description>NotSupported errors must include exact feature name</Description>
      <Rationale>Clear error messaging for debugging</Rationale>
    </Constraint>
  </Constraints>

  <Assumptions>
    <Assumption id="A-001">
      <Description>User has placed technical specification in correct location</Description>
      <Impact>Workflow cannot start without valid tech spec</Impact>
    </Assumption>
    <Assumption id="A-002">
      <Description>add_connector.sh script exists and is executable</Description>
      <Impact>Foundation setup cannot proceed without script</Impact>
    </Assumption>
    <Assumption id="A-003">
      <Description>Backend directory structure follows UCS conventions</Description>
      <Impact>File operations depend on correct structure</Impact>
    </Assumption>
    <Assumption id="A-004">
      <Description>Macro definitions are available and correct</Description>
      <Impact>Flow implementation depends on working macros</Impact>
    </Assumption>
    <Assumption id="A-005">
      <Description>Technical specification contains all required information</Description>
      <Impact>Incomplete specs will cause validation failures</Impact>
    </Assumption>
  </Assumptions>

  <Dependencies>
    <Dependency id="D-001">
      <Name>Technical Specification</Name>
      <Type>Input</Type>
      <RequiredBy>Phase 1, Phase 2, Phase 4</RequiredBy>
    </Dependency>
    <Dependency id="D-002">
      <Name>add_connector.sh Script</Name>
      <Type>Tool</Type>
      <RequiredBy>Phase 2</RequiredBy>
    </Dependency>
    <Dependency id="D-003">
      <Name>Macro Pattern Guides</Name>
      <Type>Documentation</Type>
      <RequiredBy>Phase 3, Phase 4</RequiredBy>
    </Dependency>
    <Dependency id="D-004">
      <Name>Flow Pattern Guides</Name>
      <Type>Documentation</Type>
      <RequiredBy>Phase 4</RequiredBy>
    </Dependency>
    <Dependency id="D-005">
      <Name>Utils and Enums</Name>
      <Type>Code</Type>
      <RequiredBy>Phase 4</RequiredBy>
    </Dependency>
    <Dependency id="D-006">
      <Name>Cargo Build System</Name>
      <Type>Tool</Type>
      <RequiredBy>Phase 2, Phase 4, Phase 5</RequiredBy>
    </Dependency>
    <Dependency id="D-007">
      <Name>Quality Guardian Subagent</Name>
      <Type>Service</Type>
      <RequiredBy>Phase 5</RequiredBy>
    </Dependency>
  </Dependencies>

  <Risks>
    <Risk id="R-001" level="HIGH">
      <Title>Incomplete Technical Specification</Title>
      <Description>Tech spec missing required fields or information</Description>
      <Mitigation>Validate completeness in Phase 1, fail fast with clear error</Mitigation>
    </Risk>
    <Risk id="R-002" level="MEDIUM">
      <Title>add_connector.sh Script Failure</Title>
      <Description>Script fails due to environment issues or bugs</Description>
      <Mitigation>Analyze error output, fix prerequisites, retry with diagnostics</Mitigation>
    </Risk>
    <Risk id="R-003" level="MEDIUM">
      <Title>Compilation Errors</Title>
      <Description>Code fails to compile due to type errors or missing dependencies</Description>
      <Mitigation>Build after each flow, fix errors immediately, ensure UCS conventions</Mitigation>
    </Risk>
    <Risk id="R-004" level="MEDIUM">
      <Title>Macro Misconfiguration</Title>
      <Description>Incorrect macro parameters leading to invalid code generation</Description>
      <Mitigation>Study macro guides thoroughly, validate generated code structure</Mitigation>
    </Risk>
    <Risk id="R-005" level="LOW">
      <Title>Status Mapping Errors</Title>
      <Description>Incorrect status mapping leading to wrong payment states</Description>
      <Mitigation>Map all connector statuses, never hardcode, quality review validation</Mitigation>
    </Risk>
    <Risk id="R-006" level="LOW">
      <Title>Quality Review Rejection</Title>
      <Description>Code fails quality review requiring rework</Description>
      <Mitigation>Follow UCS conventions strictly, address all quality rules during implementation</Mitigation>
    </Risk>
  </Risks>

  <TestingRequirements>
    <Requirement id="TR-001" priority="MUST">
      <Title>Compilation Test</Title>
      <Description>cargo build must succeed without errors</Description>
      <Execution>After Phase 2, after each flow in Phase 4, and in Phase 5</Execution>
    </Requirement>
    <Requirement id="TR-002" priority="MUST">
      <Title>Convention Validation Test</Title>
      <Description>Code must follow UCS conventions</Description>
      <Execution>During Phase 2 and Phase 5</Execution>
    </Requirement>
    <Requirement id="TR-003" priority="MUST">
      <Title>Single Binary Test</Title>
      <Description>Project must produce single binary</Description>
      <Execution>During Phase 5</Execution>
    </Requirement>
    <Requirement id="TR-004" priority="MUST">
      <Title>No TODOs Test</Title>
      <Description>Code must contain no TODO/FIXME comments</Description>
      <Execution>During Phase 5</Execution>
    </Requirement>
    <Requirement id="TR-005" priority="SHOULD">
      <Title>Schema Consistency Test</Title>
      <Description>Database schema must match requirements</Description>
      <Execution>During Phase 5</Execution>
    </Requirement>
  </TestingRequirements>

  <AcceptanceCriteria>
    <Criteria id="AC-001">
      <Description>Technical specification validated successfully</Description>
      <Phase>Phase 1</Phase>
    </Criteria>
    <Criteria id="AC-002">
      <Description>Foundation setup completed with cargo build success</Description>
      <Phase>Phase 2</Phase>
    </Criteria>
    <Criteria id="AC-003">
      <Description>Macro patterns studied and understood</Description>
      <Phase>Phase 3</Phase>
    </Criteria>
    <Criteria id="AC-004">
      <Description>All required flows implemented using macros</Description>
      <Phase>Phase 4</Phase>
    </Criteria>
    <Criteria id="AC-005">
      <Description>All flows compile successfully</Description>
      <Phase>Phase 4</Phase>
    </Criteria>
    <Criteria id="AC-006">
      <Description>Quality review approved</Description>
      <Phase>Phase 5</Phase>
    </Criteria>
    <Criteria id="AC-007">
      <Description>Completion report generated</Description>
      <Phase>Phase 5</Phase>
    </Criteria>
    <Criteria id="AC-008">
      <Description>Timeline finalized</Description>
      <Phase>Phase 5</Phase>
    </Criteria>
    <Criteria id="AC-009">
      <Description>Requirement analysis marked as resolved</Description>
      <Phase>Phase 6</Phase>
    </Criteria>
  </AcceptanceCriteria>

  <Glossary>
    <Term>
      <Name>UCS</Name>
      <Definition>Universal Connector System - payment connector integration framework</Definition>
    </Term>
    <Term>
      <Name>Connector</Name>
      <Definition>Third-party payment service provider integration</Definition>
    </Term>
    <Term>
      <Name>Flow</Name>
      <Definition>Specific payment operation (Authorize, Capture, Refund, etc.)</Definition>
    </Term>
    <Term>
      <Name>RouterDataV2</Name>
      <Definition>Primary data structure for routing payment requests in UCS V2</Definition>
    </Term>
    <Term>
      <Name>ConnectorIntegrationV2</Name>
      <Definition>Trait defining connector integration interface in UCS V2</Definition>
    </Term>
    <Term>
      <Name>Macro</Name>
      <Definition>Rust metaprogramming construct for code generation</Definition>
    </Term>
    <Term>
      <Name>Transformer</Name>
      <Description>Code that converts between UCS internal formats and connector-specific formats</Description>
    </Term>
    <Term>
      <Name>domain_types</Name>
      <Definition>UCS domain type library (replaces hyperswitch_domain_models)</Definition>
    </Term>
    <Term>
      <Name>PSync</Name>
      <Definition>Payment Synchronization flow</Definition>
    </Term>
    <Term>
      <Name>RSync</Name>
      <Definition>Refund Synchronization flow</Definition>
    </Term>
  </Glossary>

  <Tasks>
    <Task id="T-001" status="pending" phase="P-001">
      <Title>Read and validate technical specification</Title>
      <Description>Read tech spec from grace/rulesbook/codegen/references/{connector_name}/technical_specification.md and validate completeness</Description>
      <EstimatedTime>5 minutes</EstimatedTime>
    </Task>
    <Task id="T-002" status="pending" phase="P-001">
      <Title>Extract connector requirements</Title>
      <Description>Extract all connector requirements and supported features from tech spec</Description>
      <EstimatedTime>5 minutes</EstimatedTime>
    </Task>
    <Task id="T-003" status="pending" phase="P-001">
      <Title>Log Phase 1 completion</Title>
      <Description>Execute timeline.log_phase_end("phase_1_tech_spec_validation", status="success")</Description>
      <EstimatedTime>1 minute</EstimatedTime>
    </Task>
    <Task id="T-004" status="pending" phase="P-002">
      <Title>Validate environment</Title>
      <Description>Check repository structure, verify add_connector.sh exists, verify backend/ directory</Description>
      <EstimatedTime>2 minutes</EstimatedTime>
    </Task>
    <Task id="T-005" status="pending" phase="P-002">
      <Title>Execute add_connector.sh</Title>
      <Description>Run ./add_connector.sh {connector_name} {base_url} --force -y</Description>
      <EstimatedTime>5 minutes</EstimatedTime>
    </Task>
    <Task id="T-006" status="pending" phase="P-002">
      <Title>Validate cargo build</Title>
      <Description>Execute cargo build and ensure success</Description>
      <EstimatedTime>10 minutes</EstimatedTime>
    </Task>
    <Task id="T-007" status="pending" phase="P-002">
      <Title>Validate UCS conventions</Title>
      <Description>Verify RouterDataV2, ConnectorIntegrationV2, domain_types usage</Description>
      <EstimatedTime>3 minutes</EstimatedTime>
    </Task>
    <Task id="T-008" status="pending" phase="P-002">
      <Title>Log Phase 2 completion</Title>
      <Description>Execute timeline.log_phase_end("phase_2_foundation_setup", status="success")</Description>
      <EstimatedTime>1 minute</EstimatedTime>
    </Task>
    <Task id="T-009" status="pending" phase="P-003">
      <Title>Read macro pattern guides</Title>
      <Description>Read macro_patterns_reference.md, flow_macro_guide.md, macro_templates.md</Description>
      <EstimatedTime>10 minutes</EstimatedTime>
    </Task>
    <Task id="T-010" status="pending" phase="P-003">
      <Title>Understand macro usage</Title>
      <Description>Study create_all_prerequisites! and macro_connector_implementation! usage</Description>
      <EstimatedTime>10 minutes</EstimatedTime>
    </Task>
    <Task id="T-011" status="pending" phase="P-003">
      <Title>Log Phase 3 completion</Title>
      <Description>Execute timeline.log_phase_end("phase_2_5_macro_pattern_study", status="success")</Description>
      <EstimatedTime>1 minute</EstimatedTime>
    </Task>
    <Task id="T-012" status="pending" phase="P-004">
      <Title>Read Authorize flow pattern</Title>
      <Description>Read guides/patterns/pattern_authorize.md</Description>
      <EstimatedTime>5 minutes</EstimatedTime>
    </Task>
    <Task id="T-013" status="pending" phase="P-004">
      <Title>Read utils and enums</Title>
      <Description>Read backend/grpc-server/src/utils.rs, backend/domain_types/src/utils.rs, backend/connector-integration/src/utils.rs, backend/common_enums/src/enums.rs</Description>
      <EstimatedTime>5 minutes</EstimatedTime>
    </Task>
    <Task id="T-014" status="pending" phase="P-004">
      <Title>Generate Authorize implementation plan</Title>
      <Description>Create detailed plan for Authorize flow implementation</Description>
      <EstimatedTime>5 minutes</EstimatedTime>
    </Task>
    <Task id="T-015" status="pending" phase="P-004">
      <Title>Add Authorize to create_all_prerequisites! macro</Title>
      <Description>Add Authorize flow definition to api: [] array in connector file</Description>
      <EstimatedTime>5 minutes</EstimatedTime>
    </Task>
    <Task id="T-016" status="pending" phase="P-004">
      <Title>Implement Authorize with macro_connector_implementation!</Title>
      <Description>Add macro invocation with correct parameters for Authorize flow</Description>
      <EstimatedTime>10 minutes</EstimatedTime>
    </Task>
    <Task id="T-017" status="pending" phase="P-004">
      <Title>Create Authorize request/response types</Title>
      <Description>Define AuthorizeRequest and AuthorizeResponse structs in transformers.rs</Description>
      <EstimatedTime>15 minutes</EstimatedTime>
    </Task>
    <Task id="T-018" status="pending" phase="P-004">
      <Title>Implement Authorize transformers</Title>
      <Description>Implement TryFrom traits for request and response transformation</Description>
      <EstimatedTime>20 minutes</EstimatedTime>
    </Task>
    <Task id="T-019" status="pending" phase="P-004">
      <Title>Create status mapping function</Title>
      <Description>Implement map_{connector_name}_status_to_attempt_status function</Description>
      <EstimatedTime>10 minutes</EstimatedTime>
    </Task>
    <Task id="T-020" status="pending" phase="P-004">
      <Title>Validate Authorize flow build</Title>
      <Description>Execute cargo build and fix any errors</Description>
      <EstimatedTime>10 minutes</EstimatedTime>
    </Task>
    <Task id="T-021" status="pending" phase="P-005">
      <Title>Execute final cargo build</Title>
      <Description>Run cargo build to validate all flows compile successfully</Description>
      <EstimatedTime>10 minutes</EstimatedTime>
    </Task>
    <Task id="T-022" status="pending" phase="P-005">
      <Title>Delegate to Quality Guardian</Title>
      <Description>Submit code for comprehensive quality review</Description>
      <EstimatedTime>5 minutes</EstimatedTime>
    </Task>
    <Task id="T-023" status="pending" phase="P-005">
      <Title>Wait for quality review approval</Title>
      <Description>Wait for Quality Guardian Subagent to complete review</Description>
      <EstimatedTime>15 minutes</EstimatedTime>
    </Task>
    <Task id="T-024" status="pending" phase="P-005">
      <Title>Generate completion report</Title>
      <Description>Create comprehensive report of integration completion</Description>
      <EstimatedTime>5 minutes</EstimatedTime>
    </Task>
    <Task id="T-025" status="pending" phase="P-005">
      <Title>Log Phase 5 completion</Title>
      <Description>Execute timeline.log_phase_end("phase_4_quality_review", status="success")</Description>
      <EstimatedTime>1 minute</EstimatedTime>
    </Task>
    <Task id="T-026" status="pending" phase="P-005">
      <Title>Finalize timeline</Title>
      <Description>Execute timeline.finalize() as final workflow step</Description>
      <EstimatedTime>1 minute</EstimatedTime>
    </Task>
    <Task id="T-027" status="pending" phase="P-006">
      <Title>Mark requirement analysis as resolved</Title>
      <Description>Rename generated-requirement-analysis.xml to generated-requirement-analysis.xml.resolved</Description>
      <EstimatedTime>1 minute</EstimatedTime>
    </Task>
  </Tasks>

  <CompletionChecklist>
    <CheckItem id="CC-001" category="General">
      <Description>Technical specification read and validated</Description>
      <Verified>false</Verified>
    </CheckItem>
    <CheckItem id="CC-002" category="General">
      <Description>All connector requirements extracted</Description>
      <Verified>false</Verified>
    </CheckItem>
    <CheckItem id="CC-003" category="Foundation">
      <Description>Environment validated</Description>
      <Verified>false</Verified>
    </CheckItem>
    <CheckItem id="CC-004" category="Foundation">
      <Description>add_connector.sh executed successfully</Description>
      <Verified>false</Verified>
    </CheckItem>
    <CheckItem id="CC-005" category="Foundation">
      <Description>Cargo build successful after foundation setup</Description>
      <Verified>false</Verified>
    </CheckItem>
    <CheckItem id="CC-006" category="Foundation">
      <Description>UCS conventions validated</Description>
      <Verified>false</Verified>
    </CheckItem>
    <CheckItem id="CC-007" category="Patterns">
      <Description>Macro pattern guides read</Description>
      <Verified>false</Verified>
    </CheckItem>
    <CheckItem id="CC-008" category="Patterns">
      <Description>Macro usage understood</Description>
      <Verified>false</Verified>
    </CheckItem>
    <CheckItem id="CC-009" category="Implementation">
      <Description>Authorize flow implemented</Description>
      <Verified>false</Verified>
    </CheckItem>
    <CheckItem id="CC-010" category="Implementation">
      <Description>Flows added to create_all_prerequisites! macro</Description>
      <Verified>false</Verified>
    </CheckItem>
    <CheckItem id="CC-011" category="Implementation">
      <Description>Flows implemented with macro_connector_implementation!</Description>
      <Verified>false</Verified>
    </CheckItem>
    <CheckItem id="CC-012" category="Implementation">
      <Description>Request types created</Description>
      <Verified>false</Verified>
    </CheckItem>
    <CheckItem id="CC-013" category="Implementation">
      <Description>Response types created</Description>
      <Verified>false</Verified>
    </CheckItem>
    <CheckItem id="CC-014" category="Implementation">
      <Description>Request transformers implemented</Description>
      <Verified>false</Verified>
    </CheckItem>
    <CheckItem id="CC-015" category="Implementation">
      <Description>Response transformers implemented</Description>
      <Verified>false</Verified>
    </CheckItem>
    <CheckItem id="CC-016" category="Implementation">
      <Description>Status mapping functions created</Description>
      <Verified>false</Verified>
    </CheckItem>
    <CheckItem id="CC-017" category="Quality">
      <Description>Final cargo build successful</Description>
      <Verified>false</Verified>
    </CheckItem>
    <CheckItem id="CC-018" category="Quality">
      <Description>Quality review approved</Description>
      <Verified>false</Verified>
    </CheckItem>
    <CheckItem id="CC-019" category="Quality">
      <Description>Completion report generated</Description>
      <Verified>false</Verified>
    </CheckItem>
    <CheckItem id="CC-020" category="Quality">
      <Description>Timeline finalized</Description>
      <Verified>false</Verified>
    </CheckItem>
    <CheckItem id="CC-021" category="Code Quality">
      <Description>No TODO/FIXME comments in code</Description>
      <Verified>false</Verified>
    </CheckItem>
    <CheckItem id="CC-022" category="Code Quality">
      <Description>No fields hardcoded to None</Description>
      <Verified>false</Verified>
    </CheckItem>
    <CheckItem id="CC-023" category="Code Quality">
      <Description>Status never hardcoded, always derived</Description>
      <Verified>false</Verified>
    </CheckItem>
    <CheckItem id="CC-024" category="Code Quality">
      <Description>Specific NotSupported errors used</Description>
      <Verified>false</Verified>
    </CheckItem>
    <CheckItem id="CC-025" category="Code Quality">
      <Description>RouterDataV2 used (not RouterData)</Description>
      <Verified>false</Verified>
    </CheckItem>
    <CheckItem id="CC-026" category="Code Quality">
      <Description>ConnectorIntegrationV2 used (not ConnectorIntegration)</Description>
      <Verified>false</Verified>
    </CheckItem>
    <CheckItem id="CC-027" category="Code Quality">
      <Description>domain_types imports used (not hyperswitch_*)</Description>
      <Verified>false</Verified>
    </CheckItem>
    <CheckItem id="CC-028" category="Code Quality">
      <Description>Single binary project (no multiple binaries)</Description>
      <Verified>false</Verified>
    </CheckItem>
    <CheckItem id="CC-029" category="Code Quality">
      <Description>Database schema consistent with requirements</Description>
      <Verified>false</Verified>
    </CheckItem>
    <CheckItem id="CC-030" category="Final">
      <Description>Requirement analysis marked as resolved</Description>
      <Verified>false</Verified>
    </CheckItem>
  </CompletionChecklist>

  <SignOff>
    <GeneratedBy>Open-Thinking Model</GeneratedBy>
    <GeneratedOn>2026-02-06</GeneratedOn>
    <Version>1.0.0</Version>
    <Status>Draft</Status>
    <Notes>
      <Note>This requirement analysis is ready for execution</Note>
      <Note>All tasks are initially marked as pending</Note>
      <Note>Completion checklist items are initially unverified</Note>
      <Note>Status will be updated to "Resolved" when workflow completes</Note>
    </Notes>
  </SignOff>
</RequirementAnalysis>