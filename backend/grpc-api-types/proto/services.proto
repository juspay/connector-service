// Copyright (c) Juspay Technologies. All rights reserved.
//
// Package: ucs.v2
// File: services.proto
//
// Overview:
//   This file defines the gRPC service interfaces for the Unified Connector
//   Service (UCS) v2 API. It is the primary entry point for API consumers.
//
//   All request/response message types and shared enumerations are defined in
//   payment.proto, which this file imports.
//
// Services:
//   - PaymentService                 — Full payment lifecycle: authorize, capture, void, refund,
//                                      incremental authorization, redirect verification, and webhooks.
//   - RecurringPaymentService        — Recurring payment operations: charge and revoke.
//   - RefundService                  — Refund status synchronization.
//   - DisputeService                 — Dispute management: evidence submission, defense, acceptance,
//                                      and status sync.
//   - EventService                   — Common event handler for all services.
//   - PaymentMethodService           — Tokenize payment method, get payment method.
//   - CustomerService                — Create customer, get customer, update customer, delete customer.
//   - MerchantAuthenticationService  — Authentication and session token management: access tokens,
//                                      session tokens, and SDK session tokens for wallet integrations.
//   - PaymentMethodAuthenticationService — 3D Secure authentication workflow: pre-authentication,
//                                          authentication/challenge handling, and post-authentication validation.
//
// Webhook Flows:
//   The EventService exposes a Handle RPC for processing inbound connector
//   webhooks. The caller passes the raw HTTP request details; the service
//   verifies the source and translates the payload into a typed response.
//
// Multi-Step Flows:
//   Some operations (e.g., 3DS, DDC) span multiple RPCs. The ConnectorState
//   returned by one call must be forwarded in the next call to preserve
//   session context across steps.
//
// Related Files:
//   - payment.proto         — All shared message and enum definitions
//   - payment_methods.proto — Payment method data types

syntax = "proto3";

package ucs.v2;

import "payment.proto";

option go_package = "github.com/juspay/connector-service/backend/grpc-api-types/proto;proto";

// ============================================================================
// SERVICE DEFINITIONS
// ============================================================================

// ============================================================================
// PAYMENT SERVICE — Core payment lifecycle operations spanning authorization,
//                    capture, void, refund, and order management.
// ============================================================================

// Unified service definition for all payment related operations.
service PaymentService {
  // Authorizes a payment amount on a payment method. This reserves funds
  // without capturing them, essential for verifying availability before finalizing.
  rpc Authorize(PaymentServiceAuthorizeRequest) returns (PaymentServiceAuthorizeResponse);

  // Retrieves current payment status from the connector. Enables synchronization
  // between your system and payment processors for accurate state tracking.
  rpc Get(PaymentServiceGetRequest) returns (PaymentServiceGetResponse);

  // Cancels an authorized payment before capture. Releases held funds back to
  // customer, typically used when orders are cancelled or abandoned.
  rpc Void(PaymentServiceVoidRequest) returns (PaymentServiceVoidResponse);

  // Reverses a captured payment before settlement. Recovers funds after capture
  // but before bank settlement, used for corrections or cancellations.
  rpc Reverse(PaymentServiceReverseRequest) returns (PaymentServiceReverseResponse);

  // Finalizes an authorized payment transaction. Transfers reserved funds from
  // customer to merchant account, completing the payment lifecycle.
  rpc Capture(PaymentServiceCaptureRequest) returns (PaymentServiceCaptureResponse);

  // Initializes an order in the connector system. Sets up payment context
  // before customer enters card details for improved authorization rates.
  rpc CreateOrder(PaymentServiceCreateOrderRequest) returns (PaymentServiceCreateOrderResponse);

  // Initiates a refund to customer's payment method. Returns funds for
  // returns, cancellations, or service adjustments after original payment.
  rpc Refund(PaymentServiceRefundRequest) returns (RefundResponse);

  // Increases authorized amount if still in authorized state. Allows adding
  // charges to existing authorization for hospitality, tips, or incremental services.
  rpc IncrementalAuthorization(PaymentServiceIncrementalAuthorizationRequest) returns (PaymentServiceIncrementalAuthorizationResponse);

  // Validates redirect-based payment responses. Confirms authenticity of
  // redirect-based payment completions to prevent fraud and tampering.
  rpc VerifyRedirectResponse(PaymentServiceVerifyRedirectResponseRequest) returns (PaymentServiceVerifyRedirectResponseResponse);

  // Sets up a mandate for future payments.
  rpc Register(PaymentServiceRegisterAutoDebitRequest) returns (PaymentServiceRegisterAutoDebitResponse);
}

// ============================================================================
// RECURRING PAYMENT SERVICE — Manages recurring payment operations including
//                              charging and revoking mandates.
// ============================================================================

service RecurringPaymentService {
  // Charges using an existing stored mandate. Processes repeat payments for
  // subscriptions or recurring billing without collecting payment details.
  rpc Charge(RecurringPaymentServiceChargeRequest) returns (RecurringPaymentServiceChargeResponse);

  // Cancels an existing recurring payment mandate. Stops future automatic
  // charges on customer's stored consent for subscription cancellations.
  rpc Revoke(RecurringPaymentServiceRevokeRequest) returns (RecurringPaymentServiceRevokeResponse);
}

// ============================================================================
// REFUND SERVICE — Manages refund status synchronization.
// ============================================================================

// Service for refund-specific operations.
service RefundService {
  // Retrieves refund status from the connector. Tracks refund progress
  // through processor settlement for accurate customer communication.
  rpc Get(RefundServiceGetRequest) returns (RefundResponse);
}

// ============================================================================
// DISPUTE SERVICE — Manages chargeback lifecycle, evidence submission,
//                    and defense against fraudulent transaction claims.
// ============================================================================

// Service for dispute-specific operations.
service DisputeService {
  // Uploads evidence to dispute customer chargeback. Provides documentation
  // like receipts and delivery proof to contest fraudulent transaction claims.
  rpc SubmitEvidence(DisputeServiceSubmitEvidenceRequest) returns (DisputeServiceSubmitEvidenceResponse);

  // Retrieves dispute status and evidence submission state. Tracks dispute
  // progress through bank review process for informed decision-making.
  rpc Get(DisputeServiceGetRequest) returns (DisputeResponse);

  // Submits defense with reason code for dispute. Presents formal argument
  // against customer's chargeback claim with supporting documentation.
  rpc Defend(DisputeServiceDefendRequest) returns (DisputeServiceDefendResponse);

  // Concedes dispute and accepts chargeback loss. Acknowledges liability
  // and stops dispute defense process when evidence is insufficient.
  rpc Accept(DisputeServiceAcceptRequest) returns (DisputeServiceAcceptResponse);
}

// ============================================================================
// EVENT SERVICE — Common event handler for processing inbound connector
//                  webhooks across all services.
// ============================================================================

service EventService {
  // Processes webhook notifications from connectors. Translates connector events
  // into standardized responses for asynchronous payment state updates.
  rpc Handle(EventServiceHandleRequest) returns (EventServiceHandleResponse);
}

// ============================================================================
// PAYMENT METHOD SERVICE — Manages payment method tokenization and retrieval.
// ============================================================================

service PaymentMethodService {
  // Tokenizes payment method for secure storage. Replaces raw card details
  // with secure token for one-click payments and recurring billing.
  rpc Tokenize(PaymentMethodServiceTokenizeRequest) returns (PaymentMethodServiceTokenizeResponse);

  // // Retrieves payment method details from the connector.
  // rpc Get(PaymentMethodServiceGetRequest) returns (PaymentMethodServiceGetResponse);
}

// ============================================================================
// CUSTOMER SERVICE — Manages customer lifecycle operations.
// ============================================================================

service CustomerService {
  // Creates customer record in the connector system. Stores customer details
  // for future payment operations without re-sending personal information.
  rpc Create(CustomerServiceCreateRequest) returns (CustomerServiceCreateResponse);

  // // Retrieves customer details from the connector.
  // rpc Get(CustomerServiceGetRequest) returns (CustomerServiceGetResponse);

  // // Updates customer record in the connector system.
  // rpc Update(CustomerServiceUpdateRequest) returns (CustomerServiceUpdateResponse);

  // // Deletes customer record from the connector system.
  // rpc Delete(CustomerServiceDeleteRequest) returns (CustomerServiceDeleteResponse);
}

// ============================================================================
// MERCHANT AUTHENTICATION SERVICE — Manages access tokens and session initialization
//                                    for secure payment processing and SDK integration.
// ============================================================================

service MerchantAuthenticationService {
  // Generates short-lived connector authentication token. Provides secure
  // credentials for connector API access without storing secrets client-side.
  rpc CreateAccessToken(MerchantAuthenticationServiceCreateAccessTokenRequest) returns (MerchantAuthenticationServiceCreateAccessTokenResponse);

  // Creates session token for payment processing. Maintains session state
  // across multiple payment operations for improved security and tracking.
  rpc CreateSessionToken(MerchantAuthenticationServiceCreateSessionTokenRequest) returns (MerchantAuthenticationServiceCreateSessionTokenResponse);

  // Initializes wallet payment sessions for Apple Pay, Google Pay, etc.
  // Sets up secure context for tokenized wallet payments with device verification.
  rpc CreateSdkSessionToken(MerchantAuthenticationServiceCreateSdkSessionTokenRequest) returns (MerchantAuthenticationServiceCreateSdkSessionTokenResponse);
}

// ============================================================================
// PAYMENT METHOD AUTHENTICATION SERVICE — Manages 3D Secure authentication flows
//                                          for fraud prevention while balancing
//                                          checkout friction.
// ============================================================================

service PaymentMethodAuthenticationService {
  // Initiates 3DS flow before payment authorization. Collects device data and
  // prepares authentication context for frictionless or challenge-based verification.
  rpc PreAuthenticate(PaymentMethodAuthenticationServicePreAuthenticateRequest) returns (PaymentMethodAuthenticationServicePreAuthenticateResponse);

  // Executes 3DS challenge or frictionless verification. Authenticates customer
  // via bank challenge or behind-the-scenes verification for fraud prevention.
  rpc Authenticate(PaymentMethodAuthenticationServiceAuthenticateRequest) returns (PaymentMethodAuthenticationServiceAuthenticateResponse);

  // Validates authentication results from issuing bank. Processes bank's
  // authentication decision to determine if payment can proceed.
  rpc PostAuthenticate(PaymentMethodAuthenticationServicePostAuthenticateRequest) returns (PaymentMethodAuthenticationServicePostAuthenticateResponse);
}