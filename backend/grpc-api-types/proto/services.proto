// Copyright (c) Juspay Technologies. All rights reserved.
//
// Package: ucs.v2
// File: services.proto
//
// Overview:
//   This file defines the gRPC service interfaces for the Unified Connector
//   Service (UCS) v2 API. It is the primary entry point for API consumers.
//
//   All request/response message types and shared enumerations are defined in
//   payment.proto, which this file imports.
//
// Services:
//   - PaymentService   — Full payment lifecycle: authorize, capture, void, refund,
//                        mandates, customer creation, payment method tokenization,
//                        incremental authorization, redirect verification, and webhooks.
//   - ClientAuthService — Authentication and session token management: access tokens,
//                        session tokens, and SDK session tokens for wallet integrations.
//   - ThreeDSAuthService — 3D Secure authentication workflow: pre-authentication,
//                          authentication/challenge handling, and post-authentication validation.
//   - RefundService    — Refund status synchronization and webhook transformation.
//   - DisputeService   — Dispute management: evidence submission, defense, acceptance,
//                        status sync, and webhook transformation.
//
// Webhook Flows:
//   Each service exposes a Transform RPC for processing inbound connector
//   webhooks. The caller passes the raw HTTP request details; the service
//   verifies the source and translates the payload into a typed response.
//
// Multi-Step Flows:
//   Some operations (e.g., 3DS, DDC) span multiple RPCs. The ConnectorState
//   returned by one call must be forwarded in the next call to preserve
//   session context across steps.
//
// Related Files:
//   - payment.proto         — All shared message and enum definitions
//   - payment_methods.proto — Payment method data types

syntax = "proto3";

package ucs.v2;

import "payment.proto";

option go_package = "github.com/juspay/connector-service/backend/grpc-api-types/proto;proto";

// ============================================================================
// SERVICE DEFINITIONS
// ============================================================================

// Unified service definition for all payment related operations.
service PaymentService {
  // Authorizes a payment.
  rpc Authorize(PaymentServiceAuthorizeRequest) returns (PaymentServiceAuthorizeResponse);
  
  // Synchronizes the status of a payment.
  rpc Get(PaymentServiceGetRequest) returns (PaymentServiceGetResponse);
  
  // Voids an authorized payment.
  rpc Void(PaymentServiceVoidRequest) returns (PaymentServiceVoidResponse);
  
  // Reverses a captured payment if not yet settled. (similar to void but for post-capture transactions)
  rpc Reverse(PaymentServiceReverseRequest) returns (PaymentServiceReverseResponse);
  
  // Captures a previously authorized payment.
  rpc Capture(PaymentServiceCaptureRequest) returns (PaymentServiceCaptureResponse);

  // Creates an order before authorize.
  rpc CreateOrder(PaymentServiceCreateOrderRequest) returns (PaymentServiceCreateOrderResponse);

  // Processes a refund request.
  rpc Refund(PaymentServiceRefundRequest) returns (RefundResponse);

  // Sets up a mandate for future payments.
  rpc Register(PaymentServiceRegisterRequest) returns (PaymentServiceRegisterResponse);

  // Processes a repeat payment using existing mandate (MIT - Merchant Initiated Transaction).
  rpc ChargeAgain(PaymentServiceChargeAgainRequest) returns (PaymentServiceChargeAgainResponse);

  // Revokes an existing mandate.
  rpc RevokeMandate(PaymentServiceRevokeMandateRequest) returns (PaymentServiceRevokeMandateResponse);

  // Handles incoming webhooks from connectors.
  // This will delegate to the appropriate service transform based on the event type.
  rpc HandleEvent(PaymentServiceHandleEventRequest) returns (PaymentServiceHandleEventResponse);

  // Creates a connector customer for future payment processing.
  rpc CreateConnectorCustomer(PaymentServiceCreateConnectorCustomerRequest) returns (PaymentServiceCreateConnectorCustomerResponse);

  // Creates a payment method token for future payment processing.
  rpc CreatePaymentMethodToken(PaymentServiceCreatePaymentMethodTokenRequest) returns (PaymentServiceCreatePaymentMethodTokenResponse);

  // Authorized amount for a payment can be incremented if it is in status AUTHORIZED.
  rpc IncrementalAuthorization(PaymentServiceIncrementalAuthorizationRequest) returns (PaymentServiceIncrementalAuthorizationResponse);

  // Handles redirect responses from connectors.
  // This will perform source verification for redirect responses based on the connector configuration.
  rpc VerifyRedirectResponse(PaymentServiceVerifyRedirectResponseRequest) returns (PaymentServiceVerifyRedirectResponseResponse);
}

service ClientAuthService {
  // Creates an access token for connector authentication.
  rpc CreateAccessToken(ClientAuthServiceCreateAccessTokenRequest) returns (ClientAuthServiceCreateAccessTokenResponse);

  // Creates a session token for payment processing.
  rpc CreateSessionToken(ClientAuthServiceCreateSessionTokenRequest) returns (ClientAuthServiceCreateSessionTokenResponse);

  // Creates a session object or a session token for wallets like Apple Pay, Google Pay, etc.
  rpc SdkSessionToken(ClientAuthServiceSdkSessionTokenRequest) returns (ClientAuthServiceSdkSessionTokenResponse);
}

service ThreeDSAuthService {
  // Pre-authentication step - always used when 3DS is possible
  rpc PreAuthenticate(ThreeDSAuthServicePreAuthenticateRequest) returns (ThreeDSAuthServicePreAuthenticateResponse);
  
  // Authentication step - used for any challenge/verification step
  rpc Authenticate(ThreeDSAuthServiceAuthenticateRequest) returns (ThreeDSAuthServiceAuthenticateResponse);
  
  // Post-authentication step - used when authentication results need validation
  rpc PostAuthenticate(ThreeDSAuthServicePostAuthenticateRequest) returns (ThreeDSAuthServicePostAuthenticateResponse);
}

// Service for refund-specific operations.
service RefundService {
  // Synchronizes the status of a refund.
  rpc Get(RefundServiceGetRequest) returns (RefundResponse);

  // Handles incoming webhooks from connectors.
  rpc HandleEvent(RefundServiceHandleEventRequest) returns (RefundServiceHandleEventResponse);
}

// Service for dispute-specific operations.
service DisputeService {
  // Submits evidence for a dispute.
  rpc SubmitEvidence(DisputeServiceSubmitEvidenceRequest) returns (DisputeServiceSubmitEvidenceResponse);

  // Retrieves dispute information or evidence submission status.
  rpc Get(DisputeServiceGetRequest) returns (DisputeResponse);

  // Defends a dispute with a reason code.
  rpc Defend(DisputeServiceDefendRequest) returns (DisputeServiceDefendResponse);

  // Accepts a dispute.
  rpc Accept(DisputeServiceAcceptRequest) returns (DisputeServiceAcceptResponse);

  // Handles incoming webhooks from connectors.
  rpc HandleEvent(DisputeServiceHandleEventRequest) returns (DisputeServiceHandleEventResponse);
}
