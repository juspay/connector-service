// Copyright (c) Juspay Technologies. All rights reserved.
//
// Package: ucs.v2
// File: services.proto
//
// Overview:
//   This file defines the gRPC service interfaces for the Unified Connector
//   Service (UCS) v2 API. It is the primary entry point for API consumers.
//
//   All request/response message types and shared enumerations are defined in
//   payment.proto, which this file imports.
//
// Services:
//   - PaymentService   — Full payment lifecycle: authorize, capture, void, refund,
//                        mandates, customer creation, payment method tokenization,
//                        incremental authorization, redirect verification, and webhooks.
//   - ClientAuthService — Authentication and session token management: access tokens,
//                        session tokens, and SDK session tokens for wallet integrations.
//   - ThreeDSAuthService — 3D Secure authentication workflow: pre-authentication,
//                          authentication/challenge handling, and post-authentication validation.
//   - RefundService    — Refund status synchronization and webhook transformation.
//   - DisputeService   — Dispute management: evidence submission, defense, acceptance,
//                        status sync, and webhook transformation.
//
// Webhook Flows:
//   Each service exposes a Transform RPC for processing inbound connector
//   webhooks. The caller passes the raw HTTP request details; the service
//   verifies the source and translates the payload into a typed response.
//
// Multi-Step Flows:
//   Some operations (e.g., 3DS, DDC) span multiple RPCs. The ConnectorState
//   returned by one call must be forwarded in the next call to preserve
//   session context across steps.
//
// Related Files:
//   - payment.proto         — All shared message and enum definitions
//   - payment_methods.proto — Payment method data types

syntax = "proto3";

package ucs.v2;

import "payment.proto";

option go_package = "github.com/juspay/connector-service/backend/grpc-api-types/proto;proto";

// ============================================================================
// SERVICE DEFINITIONS
// ============================================================================

// ============================================================================
// PAYMENT SERVICE — Core payment lifecycle operations spanning authorization,
//                    capture, void, refund, and mandate management.
// ============================================================================

// Unified service definition for all payment related operations.
service PaymentService {
  // Authorizes a payment amount on a payment method. This reserves funds
  // without capturing them, essential for verifying availability before finalizing.
  rpc Authorize(PaymentServiceAuthorizeRequest) returns (PaymentServiceAuthorizeResponse);

  // Retrieves current payment status from the connector. Enables synchronization
  // between your system and payment processors for accurate state tracking.
  rpc Get(PaymentServiceGetRequest) returns (PaymentServiceGetResponse);

  // Cancels an authorized payment before capture. Releases held funds back to
  // customer, typically used when orders are cancelled or abandoned.
  rpc Void(PaymentServiceVoidRequest) returns (PaymentServiceVoidResponse);

  // Reverses a captured payment before settlement. Recovers funds after capture
  // but before bank settlement, used for corrections or cancellations.
  rpc Reverse(PaymentServiceReverseRequest) returns (PaymentServiceReverseResponse);

  // Finalizes an authorized payment transaction. Transfers reserved funds from
  // customer to merchant account, completing the payment lifecycle.
  rpc Capture(PaymentServiceCaptureRequest) returns (PaymentServiceCaptureResponse);

  // Initializes an order in the connector system. Sets up payment context
  // before customer enters card details for improved authorization rates.
  rpc CreateOrder(PaymentServiceCreateOrderRequest) returns (PaymentServiceCreateOrderResponse);

  // Initiates a refund to customer's payment method. Returns funds for
  // returns, cancellations, or service adjustments after original payment.
  rpc Refund(PaymentServiceRefundRequest) returns (RefundResponse);

  // Sets up a mandate for future recurring payments. Stores customer consent
  // for automatic charges without re-entering payment details each time.
  rpc RegisterAutoDebit(PaymentServiceRegisterAutoDebitRequest) returns (PaymentServiceRegisterAutoDebitResponse);

  // Charges using an existing stored mandate. Processes repeat payments for
  // subscriptions or recurring billing without collecting payment details.
  rpc AutoDebit(PaymentServiceAutoDebitRequest) returns (PaymentServiceAutoDebitResponse);

  // Cancels an existing recurring payment mandate. Stops future automatic
  // charges on customer's stored consent for subscription cancellations.
  rpc RevokeAutoDebit(PaymentServiceRevokeAutoDebitRequest) returns (PaymentServiceRevokeAutoDebitResponse);

  // Processes webhook notifications from connectors. Translates connector events
  // into standardized responses for asynchronous payment state updates.
  rpc HandleEvent(PaymentServiceHandleEventRequest) returns (PaymentServiceHandleEventResponse);

  // Creates customer record in the connector system. Stores customer details
  // for future payment operations without re-sending personal information.
  rpc CreateConnectorCustomer(PaymentServiceCreateConnectorCustomerRequest) returns (PaymentServiceCreateConnectorCustomerResponse);

  // Tokenizes payment method for secure storage. Replaces raw card details
  // with secure token for one-click payments and recurring billing.
  rpc CreatePaymentMethodToken(PaymentServiceCreatePaymentMethodTokenRequest) returns (PaymentServiceCreatePaymentMethodTokenResponse);

  // Increases authorized amount if still in authorized state. Allows adding
  // charges to existing authorization for hospitality, tips, or incremental services.
  rpc IncrementalAuthorization(PaymentServiceIncrementalAuthorizationRequest) returns (PaymentServiceIncrementalAuthorizationResponse);

  // Validates redirect-based payment responses. Confirms authenticity of
  // redirect-based payment completions to prevent fraud and tampering.
  rpc VerifyRedirectResponse(PaymentServiceVerifyRedirectResponseRequest) returns (PaymentServiceVerifyRedirectResponseResponse);
}

// ============================================================================
// CLIENT AUTH SERVICE — Manages access tokens and session initialization
//                        for secure payment processing and SDK integration.
// ============================================================================

service ClientAuthService {
  // Generates short-lived connector authentication token. Provides secure
  // credentials for connector API access without storing secrets client-side.
  rpc CreateAccessToken(ClientAuthServiceCreateAccessTokenRequest) returns (ClientAuthServiceCreateAccessTokenResponse);

  // Creates session token for payment processing. Maintains session state
  // across multiple payment operations for improved security and tracking.
  rpc CreateSessionToken(ClientAuthServiceCreateSessionTokenRequest) returns (ClientAuthServiceCreateSessionTokenResponse);

  // Initializes wallet payment sessions for Apple Pay, Google Pay, etc.
  // Sets up secure context for tokenized wallet payments with device verification.
  rpc SdkSessionToken(ClientAuthServiceSdkSessionTokenRequest) returns (ClientAuthServiceSdkSessionTokenResponse);
}

// ============================================================================
// 3DS AUTH SERVICE — Manages 3D Secure authentication flows for fraud
//                    prevention while balancing checkout friction.
// ============================================================================

service ThreeDSAuthService {
  // Initiates 3DS flow before payment authorization. Collects device data and
  // prepares authentication context for frictionless or challenge-based verification.
  rpc PreAuthenticate(ThreeDSAuthServicePreAuthenticateRequest) returns (ThreeDSAuthServicePreAuthenticateResponse);

  // Executes 3DS challenge or frictionless verification. Authenticates customer
  // via bank challenge or behind-the-scenes verification for fraud prevention.
  rpc Authenticate(ThreeDSAuthServiceAuthenticateRequest) returns (ThreeDSAuthServiceAuthenticateResponse);

  // Validates authentication results from issuing bank. Processes bank's
  // authentication decision to determine if payment can proceed.
  rpc PostAuthenticate(ThreeDSAuthServicePostAuthenticateRequest) returns (ThreeDSAuthServicePostAuthenticateResponse);
}

// ============================================================================
// REFUND SERVICE — Manages refund status synchronization and webhook
//                   processing for returning funds to customers.
// ============================================================================

// Service for refund-specific operations.
service RefundService {
  // Retrieves refund status from the connector. Tracks refund progress
  // through processor settlement for accurate customer communication.
  rpc Get(RefundServiceGetRequest) returns (RefundResponse);

  // Processes refund-related webhook notifications. Translates refund events
  // into standardized responses for asynchronous refund state updates.
  rpc HandleEvent(RefundServiceHandleEventRequest) returns (RefundServiceHandleEventResponse);
}

// ============================================================================
// DISPUTE SERVICE — Manages chargeback lifecycle, evidence submission,
//                    and defense against fraudulent transaction claims.
// ============================================================================

// Service for dispute-specific operations.
service DisputeService {
  // Uploads evidence to dispute customer chargeback. Provides documentation
  // like receipts and delivery proof to contest fraudulent transaction claims.
  rpc SubmitEvidence(DisputeServiceSubmitEvidenceRequest) returns (DisputeServiceSubmitEvidenceResponse);

  // Retrieves dispute status and evidence submission state. Tracks dispute
  // progress through bank review process for informed decision-making.
  rpc Get(DisputeServiceGetRequest) returns (DisputeResponse);

  // Submits defense with reason code for dispute. Presents formal argument
  // against customer's chargeback claim with supporting documentation.
  rpc Defend(DisputeServiceDefendRequest) returns (DisputeServiceDefendResponse);

  // Concedes dispute and accepts chargeback loss. Acknowledges liability
  // and stops dispute defense process when evidence is insufficient.
  rpc Accept(DisputeServiceAcceptRequest) returns (DisputeServiceAcceptResponse);

  // Processes dispute-related webhook notifications. Translates dispute events
  // into standardized responses for asynchronous dispute state updates.
  rpc HandleEvent(DisputeServiceHandleEventRequest) returns (DisputeServiceHandleEventResponse);
}
