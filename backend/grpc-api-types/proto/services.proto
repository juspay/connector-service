syntax = "proto3";

package ucs.v2;

import "payment.proto";

option go_package = "github.com/juspay/connector-service/backend/grpc-api-types/proto;proto";

// ============================================================================
// SERVICE DEFINITIONS
// ============================================================================

// Unified service definition for all payment related operations.
service PaymentService {
  // Authorizes a payment.
  rpc Authorize(PaymentServiceAuthorizeRequest) returns (PaymentServiceAuthorizeResponse);
  
  // Authorizes a payment only (without setup flows).
  rpc AuthorizeOnly(PaymentServiceAuthorizeOnlyRequest) returns (PaymentServiceAuthorizeResponse);
  
  // Synchronizes the status of a payment.
  rpc Get(PaymentServiceGetRequest) returns (PaymentServiceGetResponse);
  
  // Voids an authorized payment.
  rpc Void(PaymentServiceVoidRequest) returns (PaymentServiceVoidResponse);
  
  // Voids a captured payment (post-capture void).
  rpc VoidPostCapture(PaymentServiceVoidPostCaptureRequest) returns (PaymentServiceVoidPostCaptureResponse);
  
  // Captures a previously authorized payment.
  rpc Capture(PaymentServiceCaptureRequest) returns (PaymentServiceCaptureResponse);

  // Creates an order before authorize.
  rpc CreateOrder(PaymentServiceCreateOrderRequest) returns (PaymentServiceCreateOrderResponse);

  // Processes a refund request.
  rpc Refund(PaymentServiceRefundRequest) returns (RefundResponse);

  // Sets up a mandate for future payments.
  rpc Register(PaymentServiceRegisterRequest) returns (PaymentServiceRegisterResponse);

  // Sets up a mandate for future payments in a granular way(without setup flows).
  rpc RegisterOnly(PaymentServiceRegisterRequest) returns (PaymentServiceRegisterResponse);

  // Creates a session token for payment processing.
  rpc CreateSessionToken(PaymentServiceCreateSessionTokenRequest) returns (PaymentServiceCreateSessionTokenResponse);

  // Processes a repeat payment using existing mandate (MIT - Merchant Initiated Transaction).
  rpc RepeatEverything(PaymentServiceRepeatEverythingRequest) returns (PaymentServiceRepeatEverythingResponse);

  // Revokes an existing mandate.
  rpc MandateRevoke(PaymentServiceRevokeMandateRequest) returns (PaymentServiceRevokeMandateResponse);

  // Creates a new dispute.
  rpc Dispute(PaymentServiceDisputeRequest) returns (DisputeResponse);

  // Handles incoming webhooks from connectors.
  // This will delegate to the appropriate service transform based on the event type.
  rpc Transform(PaymentServiceTransformRequest) returns (PaymentServiceTransformResponse);

  // 3DS Authentication flows
  // Pre-authentication step - always used when 3DS is possible
  rpc PreAuthenticate(PaymentServicePreAuthenticateRequest) returns (PaymentServicePreAuthenticateResponse);
  
  // Authentication step - used for any challenge/verification step
  rpc Authenticate(PaymentServiceAuthenticateRequest) returns (PaymentServiceAuthenticateResponse);
  
  // Post-authentication step - used when authentication results need validation
  rpc PostAuthenticate(PaymentServicePostAuthenticateRequest) returns (PaymentServicePostAuthenticateResponse);

  // Creates a connector customer for future payment processing.
  rpc CreateConnectorCustomer(PaymentServiceCreateConnectorCustomerRequest) returns (PaymentServiceCreateConnectorCustomerResponse);


  // Creates a payment method token for future payment processing.
  rpc CreatePaymentMethodToken(PaymentServiceCreatePaymentMethodTokenRequest) returns (PaymentServiceCreatePaymentMethodTokenResponse);


  // Creates an access token for connector authentication.
  rpc CreateAccessToken(PaymentServiceCreateAccessTokenRequest) returns (PaymentServiceCreateAccessTokenResponse);
 
  // Creates a session object or a session token for wallets like Apple Pay, Google Pay, etc.
  rpc SdkSessionToken(PaymentServiceSdkSessionTokenRequest) returns (PaymentServiceSdkSessionTokenResponse);

  // Authorized amount for a payment can be incremented if it is in status AUTHORIZED.
  rpc IncrementalAuthorization(PaymentServiceIncrementalAuthorizationRequest) returns (PaymentServiceIncrementalAuthorizationResponse);

  // Handles redirect responses from connectors.
  // This will perform source verification for redirect responses based on the connector configuration.
  rpc VerifyRedirectResponse(PaymentServiceVerifyRedirectResponseRequest) returns (PaymentServiceVerifyRedirectResponseResponse);
}

// Service for composite payment operations.
service CompositePaymentService {
  // Runs composite authorize flow.
  rpc CompositeAuthorize(CompositeAuthorizeRequest) returns (CompositeAuthorizeResponse);
}

// Service for refund-specific operations.
service RefundService {
  // Synchronizes the status of a refund.
  rpc Get(RefundServiceGetRequest) returns (RefundResponse);

  // Handles incoming webhooks from connectors.
  rpc Transform(RefundServiceTransformRequest) returns (RefundServiceTransformResponse);
}

// Service for dispute-specific operations.
service DisputeService {
  // Submits evidence for a dispute.
  rpc SubmitEvidence(DisputeServiceSubmitEvidenceRequest) returns (DisputeServiceSubmitEvidenceResponse);

  // Retrieves dispute information or evidence submission status.
  rpc Get(DisputeServiceGetRequest) returns (DisputeResponse);

  // Defends a dispute with a reason code.
  rpc Defend(DisputeDefendRequest) returns (DisputeDefendResponse);

  // Accepts a dispute.
  rpc Accept(AcceptDisputeRequest) returns (AcceptDisputeResponse);

  // Handles incoming webhooks from connectors.
  rpc Transform(DisputeServiceTransformRequest) returns (DisputeServiceTransformResponse);
}
